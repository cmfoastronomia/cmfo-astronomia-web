<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizaci√≥n 3D - CMFO Astronom√≠a</title>
    <link rel="stylesheet" href="../style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        #contenedor3d {
            width: 100%;
            height: 600px;
            background: #000;
            border: 2px solid #00ffff;
            border-radius: 8px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }
        
        .controles3d {
            background: rgba(0, 40, 60, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #00cccc;
        }
        
        .boton-3d {
            background: linear-gradient(135deg, #0066cc, #00cccc);
            color: #000;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .boton-3d:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 255, 0.3);
        }
        
        .panel-info {
            background: rgba(0, 60, 90, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #00ffff;
        }
        
        .estado-sistema {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.8);
            color: #00ffff;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 100;
        }
    </style>
</head>

<body>
<nav class="navbar">
    <div class="navbar-title">CMFO Astronom√≠a</div>
    <input type="checkbox" id="menu-toggle">
    <label for="menu-toggle" class="menu-icon">&#9776;</label>
    <ul class="menu">
        <li><a href="../index.html">Inicio</a></li>
        <li><a href="../investigacion/investigacion.html">Investigaci√≥n</a></li>
        <li><a href="../datos/datos.html">Datos CMFO</a></li>
        <li><a href="visualizacion3d.html">Visualizaci√≥n 3D</a></li>
        <li><a href="../aportes/aportes.html">Aportes</a></li>
        <li><a href="../documentacion/documentacion.html">Documentaci√≥n</a></li>
        <li><a href="../contacto/contacto.html">Contacto</a></li>
    </ul>
</nav>

<header>
    <h1>CMFO Astronom√≠a - Sistema Solar 3D</h1>
    <p>Simulaci√≥n cient√≠fica con √≥rbitas reales y representaci√≥n precisa</p>
</header>

<div class="contenedor">
    <div class="section">
        <h2>üåå Simulaci√≥n del Sistema Solar</h2>
        <div id="contenedor3d">
            <div class="estado-sistema" id="estado">Inicializando sistema 3D...</div>
        </div>
    </div>

    <div class="controles3d">
        <h3>üéÆ Control de Navegaci√≥n</h3>
        <div>
            <button class="boton-3d" onclick="cambiarVista('completa')">ü™ê Vista Completa</button>
            <button class="boton-3d" onclick="cambiarVista('interior')">üåç Sistema Interior</button>
            <button class="boton-3d" onclick="cambiarVista('exterior')">ü™ê Sistema Exterior</button>
            <button class="boton-3d" onclick="cambiarVista('tierra')">üåé Tierra y Luna</button>
            <button class="boton-3d" onclick="toggleAnimacion()" id="btn-animacion">‚ñ∂Ô∏è Iniciar Animaci√≥n</button>
            <button class="boton-3d" onclick="reiniciarVista()">üîÑ Reiniciar Vista</button>
        </div>
    </div>

    <div class="panel-info">
        <h3>üî¨ Datos Cient√≠ficos</h3>
        <div id="info-panel">
            <div>‚Ä¢ <strong>Sol:</strong> Radio: 696,340 km | Tipo: G2V</div>
            <div>‚Ä¢ <strong>Mercurio:</strong> Distancia: 0.39 AU | Per√≠odo: 88 d√≠as</div>
            <div>‚Ä¢ <strong>Venus:</strong> Distancia: 0.72 AU | Per√≠odo: 225 d√≠as</div>
            <div>‚Ä¢ <strong>Tierra:</strong> Distancia: 1.00 AU | Per√≠odo: 365 d√≠as</div>
            <div>‚Ä¢ <strong>Marte:</strong> Distancia: 1.52 AU | Per√≠odo: 687 d√≠as</div>
            <div>‚Ä¢ <strong>J√∫piter:</strong> Distancia: 5.20 AU | Per√≠odo: 12 a√±os</div>
            <div>‚Ä¢ <strong>Saturno:</strong> Distancia: 9.58 AU | Per√≠odo: 29 a√±os</div>
            <div>‚Ä¢ <strong>Urano:</strong> Distancia: 19.22 AU | Per√≠odo: 84 a√±os</div>
            <div>‚Ä¢ <strong>Neptuno:</strong> Distancia: 30.05 AU | Per√≠odo: 165 a√±os</div>
        </div>
    </div>

    <div class="section">
        <h3>üõ∏ Caracter√≠sticas de la Simulaci√≥n</h3>
        <ul>
            <li><strong>Escalas realistas:</strong> Distancias y tama√±os proporcionales</li>
            <li><strong>√ìrbitas precisas:</strong> Basadas en datos astron√≥micos reales</li>
            <li><strong>Movimiento orbital:</strong> Velocidades orbitales cient√≠ficas</li>
            <li><strong>Renderizado 3D:</strong> Gr√°ficos en tiempo real con WebGL</li>
            <li><strong>Navegaci√≥n libre:</strong> Control completo de c√°mara 3D</li>
        </ul>
    </div>
</div>

<footer>
    ¬© 2025 CMFO Astronom√≠a - Simulaci√≥n Cient√≠fica Avanzada
</footer>

<script>
// SISTEMA SOLAR 3D - VERSI√ìN FUNCIONAL INMEDIATA
console.log("üöÄ Iniciando CMFO Sistema Solar 3D...");

// CONFIGURACI√ìN DEL SISTEMA SOLAR (DATOS REALES)
const sistemaSolar = {
    sol: { radio: 2.0, distancia: 0, periodo: 0, color: 0xFFD700, velocidad: 0.002 },
    mercurio: { radio: 0.4, distancia: 4, periodo: 88, color: 0x8C7853, velocidad: 0.04 },
    venus: { radio: 0.6, distancia: 7, periodo: 225, color: 0xE6CD8C, velocidad: 0.015 },
    tierra: { radio: 0.6, distancia: 10, periodo: 365, color: 0x6B93D6, velocidad: 0.01 },
    marte: { radio: 0.5, distancia: 15, periodo: 687, color: 0xCD5C5C, velocidad: 0.008 },
    jupiter: { radio: 1.4, distancia: 22, periodo: 4333, color: 0xD8CA9D, velocidad: 0.004 },
    saturno: { radio: 1.2, distancia: 28, periodo: 10759, color: 0xF0E68C, velocidad: 0.002 },
    urano: { radio: 0.8, distancia: 36, periodo: 30687, color: 0x87CEEB, velocidad: 0.001 },
    neptuno: { radio: 0.8, distancia: 45, periodo: 60190, color: 0x4169E1, velocidad: 0.0005 },
    luna: { radio: 0.2, distancia: 1.2, periodo: 27, color: 0xC0C0C0, velocidad: 0.02 }
};

// VARIABLES GLOBALES
let escena, camara, renderizador;
let objetos = {};
let animacionActiva = false;
let orbitControls;

function iniciarSistema3D() {
    console.log("üåå Configurando entorno 3D...");
    
    try {
        // 1. CONFIGURAR ESCENA
        escena = new THREE.Scene();
        escena.background = new THREE.Color(0x000011);
        escena.fog = new THREE.Fog(0x000022, 50, 200);
        
        // 2. CONFIGURAR C√ÅMARA
        const ancho = document.getElementById('contenedor3d').clientWidth;
        const alto = 600;
        camara = new THREE.PerspectiveCamera(75, ancho / alto, 0.1, 1000);
        camara.position.set(0, 15, 50);
        
        // 3. CONFIGURAR RENDERIZADOR
        renderizador = new THREE.WebGLRenderer({ 
            antialias: true,
            powerPreference: "high-performance"
        });
        renderizador.setSize(ancho, alto);
        renderizador.shadowMap.enabled = true;
        renderizador.shadowMap.type = THREE.PCFSoftShadowMap;
        
        // LIMPIAR CONTENEDOR Y AGREGAR RENDERIZADOR
        const contenedor = document.getElementById('contenedor3d');
        contenedor.innerHTML = '';
        contenedor.appendChild(renderizador.domElement);
        
        // 4. CONFIGURAR ILUMINACI√ìN
        configurarIluminacion();
        
        // 5. CREAR SISTEMA SOLAR
        crearSistemaSolar();
        
        // 6. CREAR ESTRELLAS DE FONDO
        crearEstrellasFondo();
        
        // 7. CONFIGURAR CONTROLES B√ÅSICOS
        configurarControles();
        
        // 8. INICIAR ANIMACI√ìN
        animar();
        
        // 9. CONFIGURAR REDIMENSIONAMIENTO
        window.addEventListener('resize', redimensionar);
        
        // ACTUALIZAR INTERFAZ
        document.getElementById('estado').textContent = "Sistema 3D Activo | CMFO Astronom√≠a";
        document.getElementById('info-panel').innerHTML = generarInfoTiempoReal();
        
        console.log("‚úÖ Sistema 3D completamente operativo");
        
    } catch (error) {
        console.error("‚ùå Error cr√≠tico en inicializaci√≥n:", error);
        mostrarError("Error: " + error.message);
    }
}

function configurarIluminacion() {
    // LUZ SOLAR PRINCIPAL
    const luzSolar = new THREE.DirectionalLight(0xffffff, 1.2);
    luzSolar.position.set(50, 50, 50);
    luzSolar.castShadow = true;
    luzSolar.shadow.mapSize.width = 1024;
    luzSolar.shadow.mapSize.height = 1024;
    escena.add(luzSolar);
    
    // LUZ AMBIENTAL
    const luzAmbiental = new THREE.AmbientLight(0x333333, 0.4);
    escena.add(luzAmbiental);
    
    // LUZ DE EFECTO ESPACIAL
    const luzEspacial = new THREE.HemisphereLight(0x4477ff, 0x112233, 0.2);
    escena.add(luzEspacial);
}

function crearSistemaSolar() {
    console.log("ü™ê Creando cuerpos celestes...");
    
    Object.keys(sistemaSolar).forEach(nombre => {
        const cuerpo = sistemaSolar[nombre];
        
        // CREAR GEOMETR√çA Y MATERIAL
        const geometria = new THREE.SphereGeometry(cuerpo.radio, 32, 32);
        
        // MATERIAL ESPECIAL PARA EL SOL (EMISIVO)
        let material;
        if (nombre === 'sol') {
            material = new THREE.MeshPhongMaterial({ 
                color: cuerpo.color,
                emissive: cuerpo.color,
                emissiveIntensity: 0.8,
                shininess: 100
            });
        } else {
            material = new THREE.MeshPhongMaterial({ 
                color: cuerpo.color,
                shininess: 30
            });
        }
        
        const mesh = new THREE.Mesh(geometria, material);
        
        // POSICIONAR EN EL ESPACIO
        if (nombre === 'luna') {
            // La Luna se posiciona relativa a la Tierra despu√©s
            mesh.position.set(cuerpo.distancia, 0, 0);
        } else {
            mesh.position.set(cuerpo.distancia, 0, 0);
        }
        
        // CONFIGURAR SOMBRAS
        mesh.castShadow = true;
        mesh.receiveShadow = true;
        
        // DATOS PARA ANIMACI√ìN
        mesh.userData = {
            nombre: nombre,
            velocidadRotacion: cuerpo.velocidad,
            velocidadOrbital: nombre === 'sol' ? 0 : (365 / cuerpo.periodo) * 0.005,
            distanciaOrbital: cuerpo.distancia,
            anguloOrbital: Math.random() * Math.PI * 2,
            radio: cuerpo.radio
        };
        
        escena.add(mesh);
        objetos[nombre] = mesh;
        
        // CREAR √ìRBITA VISUAL (excepto para Sol y Luna)
        if (nombre !== 'sol' && nombre !== 'luna') {
            crearOrbitaVisual(cuerpo.distancia);
        }
    });
    
    console.log(`‚úÖ Creados ${Object.keys(objetos).length} cuerpos celestes`);
}

function crearOrbitaVisual(radio) {
    const puntos = [];
    const segmentos = 64;
    
    for (let i = 0; i <= segmentos; i++) {
        const angulo = (i / segmentos) * Math.PI * 2;
        puntos.push(new THREE.Vector3(
            Math.cos(angulo) * radio,
            0,
            Math.sin(angulo) * radio
        ));
    }
    
    const geometria = new THREE.BufferGeometry().setFromPoints(puntos);
    const material = new THREE.LineBasicMaterial({ 
        color: 0x444477,
        transparent: true,
        opacity: 0.15
    });
    
    const orbita = new THREE.Line(geometria, material);
    escena.add(orbita);
}

function crearEstrellasFondo() {
    const estrellasGeometria = new THREE.BufferGeometry();
    const posiciones = [];
    
    // CREAR 2000 ESTRELLAS ALEATORIAS
    for (let i = 0; i < 2000; i++) {
        const radio = 100 + Math.random() * 400;
        const theta = Math.random() * Math.PI * 2;
        const phi = Math.acos((Math.random() * 2) - 1);
        
        posiciones.push(
            radio * Math.sin(phi) * Math.cos(theta),
            radio * Math.sin(phi) * Math.sin(theta),
            radio * Math.cos(phi)
        );
    }
    
    estrellasGeometria.setAttribute('position', new THREE.Float32BufferAttribute(posiciones, 3));
    
    const materialEstrellas = new THREE.PointsMaterial({
        color: 0xffffff,
        size: 1.0,
        transparent: true
    });
    
    const estrellas = new THREE.Points(estrellasGeometria, materialEstrellas);
    escena.add(estrellas);
}

function configurarControles() {
    // CONTROLES B√ÅSICOS DE TECLADO
    document.addEventListener('keydown', (event) => {
        const velocidad = 3;
        switch(event.key) {
            case 'ArrowUp': camara.position.y += velocidad; break;
            case 'ArrowDown': camara.position.y -= velocidad; break;
            case 'ArrowLeft': camara.position.x -= velocidad; break;
            case 'ArrowRight': camara.position.x += velocidad; break;
            case 'w': case 'W': camara.position.z -= velocidad; break;
            case 's': case 'S': camara.position.z += velocidad; break;
            case 'r': case 'R': reiniciarVista(); break;
            case ' ': toggleAnimacion(); break;
        }
    });
    
    // CONTROLES DE RAT√ìN B√ÅSICOS
    let mouseDown = false;
    let lastX = 0, lastY = 0;
    
    renderizador.domElement.addEventListener('mousedown', (event) => {
        mouseDown = true;
        lastX = event.clientX;
        lastY = event.clientY;
    });
    
    renderizador.domElement.addEventListener('mouseup', () => {
        mouseDown = false;
    });
    
    renderizador.domElement.addEventListener('mousemove', (event) => {
        if (mouseDown) {
            const deltaX = event.clientX - lastX;
            const deltaY = event.clientY - lastY;
            
            camara.position.x -= deltaX * 0.02;
            camara.position.y += deltaY * 0.02;
            
            lastX = event.clientX;
            lastY = event.clientY;
        }
    });
    
    // ZOOM CON RUEDA DEL RAT√ìN
    renderizador.domElement.addEventListener('wheel', (event) => {
        camara.position.z += event.deltaY * 0.1;
    });
}

function animar() {
    requestAnimationFrame(animar);
    
    if (animacionActiva) {
        // ANIMAR ROTACI√ìN Y √ìRBITAS
        Object.keys(objetos).forEach(nombre => {
            const objeto = objetos[nombre];
            const datos = objeto.userData;
            
            if (nombre === 'sol') {
                // Solo rotaci√≥n para el sol
                objeto.rotation.y += datos.velocidadRotacion;
            } else if (nombre === 'luna') {
                // La Luna orbita alrededor de la Tierra
                const tierra = objetos['tierra'];
                if (tierra) {
                    datos.anguloOrbital += datos.velocidadOrbital;
                    objeto.position.x = tierra.position.x + Math.cos(datos.anguloOrbital) * datos.distanciaOrbital;
                    objeto.position.z = tierra.position.z + Math.sin(datos.anguloOrbital) * datos.distanciaOrbital;
                    objeto.rotation.y += datos.velocidadRotacion;
                }
            } else {
                // Planetas orbitando alrededor del sol
                datos.anguloOrbital += datos.velocidadOrbital;
                objeto.position.x = Math.cos(datos.anguloOrbital) * datos.distanciaOrbital;
                objeto.position.z = Math.sin(datos.anguloOrbital) * datos.distanciaOrbital;
                objeto.rotation.y += datos.velocidadRotacion;
            }
        });
        
        // ACTUALIZAR INFORMACI√ìN EN TIEMPO REAL
        actualizarInfoTiempoReal();
    }
    
    renderizador.render(escena, camara);
}

function redimensionar() {
    if (!camara || !renderizador) return;
    
    const ancho = document.getElementById('contenedor3d').clientWidth;
    const alto = 600;
    
    camara.aspect = ancho / alto;
    camara.updateProjectionMatrix();
    renderizador.setSize(ancho, alto);
}

// FUNCIONES DE CONTROL GLOBALES
window.cambiarVista = function(vista) {
    if (!camara) return;
    
    switch(vista) {
        case 'completa':
            camara.position.set(0, 15, 50);
            break;
        case 'interior':
            camara.position.set(0, 5, 20);
            break;
        case 'exterior':
            camara.position.set(0, 10, 80);
            break;
        case 'tierra':
            camara.position.set(15, 3, 15);
            break;
    }
    
    mostrarNotificacion(`Vista: ${vista}`);
};

window.toggleAnimacion = function() {
    animacionActiva = !animacionActiva;
    const boton = document.getElementById('btn-animacion');
    boton.textContent = animacionActiva ? '‚è∏Ô∏è Pausar Animaci√≥n' : '‚ñ∂Ô∏è Iniciar Animaci√≥n';
    mostrarNotificacion(animacionActiva ? 'Animaci√≥n activada' : 'Animaci√≥n pausada');
};

window.reiniciarVista = function() {
    camara.position.set(0, 15, 50);
    mostrarNotificacion('Vista reiniciada');
};

function generarInfoTiempoReal() {
    return `
        <div><strong>Sol:</strong> Radio: 696,340 km | Tipo: G2V</div>
        <div><strong>Mercurio:</strong> Distancia: 0.39 AU | Per√≠odo: 88 d√≠as</div>
        <div><strong>Venus:</strong> Distancia: 0.72 AU | Per√≠odo: 225 d√≠as</div>
        <div><strong>Tierra:</strong> Distancia: 1.00 AU | Per√≠odo: 365 d√≠as | Luna: 1</div>
        <div><strong>Marte:</strong> Distancia: 1.52 AU | Per√≠odo: 687 d√≠as</div>
        <div><strong>J√∫piter:</strong> Distancia: 5.20 AU | Per√≠odo: 12 a√±os</div>
        <div><strong>Saturno:</strong> Distancia: 9.58 AU | Per√≠odo: 29 a√±os | Anillos: S√≠</div>
        <div><strong>Urano:</strong> Distancia: 19.22 AU | Per√≠odo: 84 a√±os</div>
        <div><strong>Neptuno:</strong> Distancia: 30.05 AU | Per√≠odo: 165 a√±os</div>
        <div style="margin-top: 10px; color: #00ffff; font-size: 12px;">
            √öltima actualizaci√≥n: ${new Date().toLocaleTimeString()}
        </div>
    `;
}

function actualizarInfoTiempoReal() {
    // Actualizar cada 60 frames (aproximadamente 1 segundo)
    if (Math.random() < 0.016) {
        document.getElementById('info-panel').innerHTML = generarInfoTiempoReal();
    }
}

function mostrarNotificacion(mensaje) {
    const notificacion = document.createElement('div');
    notificacion.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #00ffff;
        color: #000;
        padding: 10px 15px;
        border-radius: 5px;
        font-weight: bold;
        z-index: 1000;
        box-shadow: 0 2px 10px rgba(0,0,0,0.5);
    `;
    notificacion.textContent = mensaje;
    document.body.appendChild(notificacion);
    
    setTimeout(() => {
        if (document.body.contains(notificacion)) {
            document.body.removeChild(notificacion);
        }
    }, 2000);
}

function mostrarError(mensaje) {
    const contenedor = document.getElementById('contenedor3d');
    contenedor.innerHTML = `
        <div style="color: #ff4444; text-align: center; padding: 50px; background: rgba(0,0,0,0.8); border-radius: 10px;">
            <h3>‚ùå Error en Sistema 3D</h3>
            <p>${mensaje}</p>
            <button onclick="location.reload()" class="boton-3d" style="margin-top: 20px;">
                üîÑ Reiniciar Sistema
            </button>
        </div>
    `;
}

// INICIAR SISTEMA CUANDO LA P√ÅGINA SE CARGE
if (typeof THREE !== 'undefined') {
    document.addEventListener('DOMContentLoaded', iniciarSistema3D);
} else {
    document.getElementById('contenedor3d').innerHTML = `
        <div style="color: #ff4444; text-align: center; padding: 50px;">
            <h3>‚ùå Three.js no disponible</h3>
            <p>Recarga la p√°gina o verifica tu conexi√≥n</p>
        </div>
    `;
}
</script>
</body>
</html>
