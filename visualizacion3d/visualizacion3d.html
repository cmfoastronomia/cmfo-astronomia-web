<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizaci√≥n 3D - CMFO Astronom√≠a</title>
    <link rel="stylesheet" href="../style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        #contenedor3d {
            width: 100%;
            height: 600px;
            background: #000;
            border: 2px solid #00ffff;
            border-radius: 8px;
            margin: 20px 0;
            position: relative;
        }
        
        .controles3d {
            background: rgba(0, 40, 60, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #00cccc;
        }
        
        .boton-3d {
            background: linear-gradient(135deg, #0066cc, #00cccc);
            color: #000;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-weight: bold;
        }
        
        .panel-info {
            background: rgba(0, 60, 90, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #00ffff;
        }
        
        .textura-cargando {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.8);
            color: #00ffff;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
        }
    </style>
</head>

<body>
<nav class="navbar">
    <div class="navbar-title">CMFO Astronom√≠a</div>
    <input type="checkbox" id="menu-toggle">
    <label for="menu-toggle" class="menu-icon">&#9776;</label>
    <ul class="menu">
        <li><a href="../index.html">Inicio</a></li>
        <li><a href="../investigacion/investigacion.html">Investigaci√≥n</a></li>
        <li><a href="../datos/datos.html">Datos CMFO</a></li>
        <li><a href="visualizacion3d.html">Visualizaci√≥n 3D</a></li>
        <li><a href="../aportes/aportes.html">Aportes</a></li>
        <li><a href="../documentacion/documentacion.html">Documentaci√≥n</a></li>
        <li><a href="../contacto/contacto.html">Contacto</a></li>
    </ul>
</nav>

<header>
    <h1>CMFO Astronom√≠a - Sistema Solar 3D</h1>
    <p>Visualizaci√≥n con datos astron√≥micos reales y texturas de alta resoluci√≥n</p>
</header>

<div class="contenedor">
    <div class="section">
        <h2>üåå Sistema Solar en Tiempo Real</h2>
        <div id="contenedor3d">
            <div style="color: #00ffff; text-align: center; padding: 50px;">
                <div>Cargando universo 3D...</div>
                <div style="font-size: 12px; margin-top: 10px;">Texturas reales ‚Ä¢ Datos cient√≠ficos ‚Ä¢ √ìrbitas precisas</div>
            </div>
        </div>
    </div>

    <div class="controles3d">
        <h3>üéÆ Navegaci√≥n Espacial</h3>
        <div>
            <button class="boton-3d" onclick="cambiarVista('sistema')">ü™ê Vista Completa</button>
            <button class="boton-3d" onclick="cambiarVista('planetas_interiores')">üåç Planetas Interiores</button>
            <button class="boton-3d" onclick="cambiarVista('gigantes_gaseosos')">ü™ê Gigantes Gaseosos</button>
            <button class="boton-3d" onclick="cambiarVista('lunas')">üåô Sistema Tierra-Luna</button>
            <button class="boton-3d" onclick="animar()">‚ñ∂Ô∏è Rotaci√≥n Orbital</button>
            <button class="boton-3d" onclick="pausar()">‚è∏Ô∏è Pausar</button>
        </div>
    </div>

    <div class="panel-info">
        <h3>üî≠ Informaci√≥n Cient√≠fica</h3>
        <div id="info-panel">
            <div>‚Ä¢ Sistema solar a escala realista</div>
            <div>‚Ä¢ Texturas de superficies reales</div>
            <div>‚Ä¢ √ìrbitas calculadas cient√≠ficamente</div>
            <div>‚Ä¢ Datos de posiciones actuales</div>
        </div>
    </div>

    <div class="section">
        <h3>üõ∞Ô∏è Caracter√≠sticas T√©cnicas</h3>
        <ul>
            <li><strong>Texturas Reales:</strong> Im√°genes de telescopios y sondas espaciales</li>
            <li><strong>Escalas Precisas:</strong> Tama√±os y distancias realistas</li>
            <li><strong>√ìrbitas Calculadas:</strong> Movimiento orbital cient√≠fico</li>
            <li><strong>Navegaci√≥n 3D:</strong> Control completo de c√°mara</li>
            <li><strong>Renderizado WebGL:</strong> Gr√°ficos de alta performance</li>
        </ul>
    </div>
</div>

<footer>
    ¬© 2025 CMFO Astronom√≠a - Visualizaci√≥n Cient√≠fica Avanzada
</footer>

<script>
// SISTEMA SOLAR 3D CON TEXTURAS REALES Y DATOS CIENT√çFICOS
console.log("üöÄ Iniciando Visualizaci√≥n 3D CMFO...");

// TEXTURAS REALES DE NASA Y SONDA ESPACIALES
const texturas = {
    sol: 'https://solarsystem.nasa.gov/system/resources/detail_files/246_PIA14093_full_2.jpg',
    mercurio: 'https://solarsystem.nasa.gov/system/resources/detail_files/435_mercury_carousel_1.jpg',
    venus: 'https://solarsystem.nasa.gov/system/resources/detail_files/610_venus_carousel_2.jpg',
    tierra: 'https://eoimages.gsfc.nasa.gov/images/imagerecords/144000/144898/BlackMarble_2016_01deg.jpg',
    marte: 'https://solarsystem.nasa.gov/system/resources/detail_files/610_mars_carousel_1.jpg',
    jupiter: 'https://solarsystem.nasa.gov/system/resources/detail_files/2486_stsci-h-p1936a_1800.jpg',
    saturno: 'https://solarsystem.nasa.gov/system/resources/detail_files/2490_stsci-h-p1936a_1800.jpg',
    urano: 'https://solarsystem.nasa.gov/system/resources/detail_files/599_uranus_carousel_2.jpg',
    neptuno: 'https://solarsystem.nasa.gov/system/resources/detail_files/611_neptune_carousel_2.jpg',
    luna: 'https://solarsystem.nasa.gov/system/resources/detail_files/2488_stsci-h-p1943a-f_1200.jpg'
};

// DATOS CIENT√çFICOS REALES DEL SISTEMA SOLAR
const datosCientificos = {
    sol: { radio: 6.96, distancia: 0, periodo: 0, color: '#FFD700' },
    mercurio: { radio: 0.24, distancia: 5.79, periodo: 88, color: '#8C8C8C' },
    venus: { radio: 0.61, distancia: 10.82, periodo: 225, color: '#E6CD8C' },
    tierra: { radio: 0.64, distancia: 15.00, periodo: 365, color: '#1E90FF' },
    marte: { radio: 0.34, distancia: 22.79, periodo: 687, color: '#CD5C5C' },
    jupiter: { radio: 7.15, distancia: 77.86, periodo: 4333, color: '#DAA520' },
    saturno: { radio: 6.03, distancia: 143.35, periodo: 10759, color: '#F0E68C' },
    urano: { radio: 2.56, distancia: 287.25, periodo: 30687, color: '#87CEEB' },
    neptuno: { radio: 2.48, distancia: 449.51, periodo: 60190, color: '#4169E1' },
    luna: { radio: 0.17, distancia: 0.38, periodo: 27, color: '#C0C0C0' }
};

let escena, camara, renderizador;
let objetos3D = {};
let animacionActiva = true;
let texturasCargadas = 0;
let totalTexturas = Object.keys(texturas).length;

function iniciarSistema3D() {
    console.log("üåå Inicializando universo 3D...");
    
    try {
        // CONFIGURAR ESCENA
        escena = new THREE.Scene();
        escena.background = new THREE.Color(0x000011);
        escena.fog = new THREE.Fog(0x000033, 50, 300);
        
        // CONFIGURAR C√ÅMARA
        const ancho = document.getElementById('contenedor3d').clientWidth;
        const alto = 600;
        camara = new THREE.PerspectiveCamera(60, ancho / alto, 0.1, 2000);
        camara.position.set(0, 30, 100);
        
        // CONFIGURAR RENDERIZADOR
        renderizador = new THREE.WebGLRenderer({ 
            antialias: true,
            alpha: true
        });
        renderizador.setSize(ancho, alto);
        renderizador.shadowMap.enabled = true;
        renderizador.shadowMap.type = THREE.PCFSoftShadowMap;
        
        // LIMPIAR Y AGREGAR AL DOM
        const contenedor = document.getElementById('contenedor3d');
        contenedor.innerHTML = '';
        contenedor.appendChild(renderizador.domElement);
        
        // CONFIGURAR ILUMINACI√ìN
        configurarIluminacion();
        
        // CARGAR TEXTURAS Y CREAR SISTEMA SOLAR
        cargarTexturasYCrearSistema();
        
        // INICIAR ANIMACI√ìN
        animar();
        
        // CONFIGURAR CONTROLES DE C√ÅMARA
        configurarControlesCamara();
        
        // MANEJAR REDIMENSIONAMIENTO
        window.addEventListener('resize', redimensionar);
        
        console.log("‚úÖ Universo 3D inicializado");
        
    } catch (error) {
        console.error("‚ùå Error cr√≠tico:", error);
        mostrarError("Error en visualizaci√≥n 3D: " + error.message);
    }
}

function configurarIluminacion() {
    // LUZ SOLAR PRINCIPAL
    const luzSolar = new THREE.DirectionalLight(0xffffff, 1.5);
    luzSolar.position.set(50, 50, 50);
    luzSolar.castShadow = true;
    luzSolar.shadow.mapSize.width = 2048;
    luzSolar.shadow.mapSize.height = 2048;
    escena.add(luzSolar);
    
    // LUZ AMBIENTAL
    const luzAmbiental = new THREE.AmbientLight(0x333333, 0.3);
    escena.add(luzAmbiental);
    
    // LUZ DE EFECTO ESPACIAL
    const luzEspacial = new THREE.HemisphereLight(0x4477ff, 0x112233, 0.1);
    escena.add(luzEspacial);
}

function cargarTexturasYCrearSistema() {
    console.log("üñºÔ∏è Cargando texturas reales...");
    
    Object.keys(texturas).forEach(nombre => {
        const loader = new THREE.TextureLoader();
        loader.load(
            texturas[nombre],
            (textura) => {
                texturasCargadas++;
                crearCuerpoCeleste(nombre, textura);
                actualizarProgresoTexturas();
                
                if (texturasCargadas === totalTexturas) {
                    console.log("‚úÖ Todas las texturas cargadas");
                    crearOrbitas();
                    crearEstrellasFondo();
                }
            },
            undefined,
            (error) => {
                console.warn(`‚ùå Error cargando textura ${nombre}:`, error);
                texturasCargadas++;
                crearCuerpoCeleste(nombre, null); // Crear con color s√≥lido
                actualizarProgresoTexturas();
            }
        );
    });
}

function crearCuerpoCeleste(nombre, textura) {
    const datos = datosCientificos[nombre];
    if (!datos) return;
    
    // ESCALAR RADIOS PARA VISUALIZACI√ìN (manteniendo proporciones)
    const radioVisual = datos.radio * (nombre === 'sol' ? 0.3 : 2);
    const distanciaVisual = datos.distancia * 0.8;
    
    const geometria = new THREE.SphereGeometry(radioVisual, 64, 64);
    
    let material;
    if (textura) {
        material = new THREE.MeshPhongMaterial({ 
            map: textura,
            shininess: nombre === 'sol' ? 100 : 30
        });
    } else {
        material = new THREE.MeshPhongMaterial({ 
            color: datos.color,
            shininess: 20
        });
    }
    
    const cuerpo = new THREE.Mesh(geometria, material);
    
    // POSICIONAR EN EL SISTEMA SOLAR
    if (nombre === 'luna') {
        // La Luna orbita alrededor de la Tierra
        cuerpo.position.set(distanciaVisual, 0, 0);
    } else {
        cuerpo.position.set(distanciaVisual, 0, 0);
    }
    
    cuerpo.castShadow = true;
    cuerpo.receiveShadow = true;
    
    // DATOS PARA ANIMACI√ìN
    cuerpo.userData = {
        nombre: nombre,
        velocidadRotacion: 0.01 + Math.random() * 0.02,
        velocidadOrbital: nombre === 'sol' ? 0 : (365 / datos.periodo) * 0.002,
        distanciaOrbital: distanciaVisual,
        anguloOrbital: Math.random() * Math.PI * 2,
        tiempo: Math.random() * 100
    };
    
    // EFECTO ESPECIAL PARA EL SOL
    if (nombre === 'sol') {
        material.emissive = new THREE.Color(0xffff00);
        material.emissiveIntensity = 0.3;
    }
    
    escena.add(cuerpo);
    objetos3D[nombre] = cuerpo;
    
    console.log(`‚úÖ ${nombre} creado`);
}

function crearOrbitas() {
    Object.keys(objetos3D).forEach(nombre => {
        const cuerpo = objetos3D[nombre];
        if (nombre !== 'sol' && nombre !== 'luna') {
            const radioOrbita = cuerpo.userData.distanciaOrbital;
            crearOrbitaVisual(radioOrbita);
        }
    });
}

function crearOrbitaVisual(radio) {
    const puntos = [];
    const segmentos = 128;
    
    for (let i = 0; i <= segmentos; i++) {
        const angulo = (i / segmentos) * Math.PI * 2;
        puntos.push(new THREE.Vector3(
            Math.cos(angulo) * radio,
            0,
            Math.sin(angulo) * radio
        ));
    }
    
    const geometria = new THREE.BufferGeometry().setFromPoints(puntos);
    const material = new THREE.LineBasicMaterial({ 
        color: 0x444477,
        transparent: true,
        opacity: 0.2
    });
    
    const orbita = new THREE.Line(geometria, material);
    escena.add(orbita);
}

function crearEstrellasFondo() {
    const estrellasGeometria = new THREE.BufferGeometry();
    const posiciones = [];
    const tamanos = [];
    
    // CREAR 5000 ESTRELLAS ALEATORIAS
    for (let i = 0; i < 5000; i++) {
        const radio = 800 + Math.random() * 200;
        const theta = Math.random() * Math.PI * 2;
        const phi = Math.acos((Math.random() * 2) - 1);
        
        posiciones.push(
            radio * Math.sin(phi) * Math.cos(theta),
            radio * Math.sin(phi) * Math.sin(theta),
            radio * Math.cos(phi)
        );
        
        tamanos.push(Math.random() * 2);
    }
    
    estrellasGeometria.setAttribute('position', new THREE.Float32BufferAttribute(posiciones, 3));
    estrellasGeometria.setAttribute('size', new THREE.Float32BufferAttribute(tamanos, 1));
    
    const materialEstrellas = new THREE.PointsMaterial({
        color: 0xffffff,
        size: 0.7,
        transparent: true
    });
    
    const estrellas = new THREE.Points(estrellasGeometria, materialEstrellas);
    escena.add(estrellas);
}

function configurarControlesCamara() {
    // CONTROLES MANUALES CON TECLADO Y RAT√ìN
    document.addEventListener('keydown', (event) => {
        const velocidad = 5;
        switch(event.key) {
            case 'ArrowUp': camara.position.y += velocidad; break;
            case 'ArrowDown': camara.position.y -= velocidad; break;
            case 'ArrowLeft': camara.position.x -= velocidad; break;
            case 'ArrowRight': camara.position.x += velocidad; break;
            case 'w': case 'W': camara.position.z -= velocidad; break;
            case 's': case 'S': camara.position.z += velocidad; break;
        }
    });
}

function animar() {
    requestAnimationFrame(animar);
    
    if (animacionActiva) {
        // ANIMAR ROTACI√ìN Y √ìRBITAS
        Object.keys(objetos3D).forEach(nombre => {
            const cuerpo = objetos3D[nombre];
            const datos = cuerpo.userData;
            
            if (nombre === 'sol') {
                // Solo rotaci√≥n para el sol
                cuerpo.rotation.y += datos.velocidadRotacion;
            } else if (nombre === 'luna') {
                // La Luna orbita alrededor de la Tierra
                const tierra = objetos3D['tierra'];
                if (tierra) {
                    datos.anguloOrbital += datos.velocidadOrbital;
                    cuerpo.position.x = tierra.position.x + Math.cos(datos.anguloOrbital) * datos.distanciaOrbital;
                    cuerpo.position.z = tierra.position.z + Math.sin(datos.anguloOrbital) * datos.distanciaOrbital;
                    cuerpo.rotation.y += datos.velocidadRotacion;
                }
            } else {
                // Planetas orbitando alrededor del sol
                datos.anguloOrbital += datos.velocidadOrbital;
                cuerpo.position.x = Math.cos(datos.anguloOrbital) * datos.distanciaOrbital;
                cuerpo.position.z = Math.sin(datos.anguloOrbital) * datos.distanciaOrbital;
                cuerpo.rotation.y += datos.velocidadRotacion;
            }
        });
    }
    
    renderizador.render(escena, camara);
}

function actualizarProgresoTexturas() {
    const progreso = Math.round((texturasCargadas / totalTexturas) * 100);
    const mensaje = `Cargando texturas: ${progreso}%`;
    console.log(mensaje);
}

function redimensionar() {
    if (!camara || !renderizador) return;
    
    const ancho = document.getElementById('contenedor3d').clientWidth;
    const alto = 600;
    
    camara.aspect = ancho / alto;
    camara.updateProjectionMatrix();
    renderizador.setSize(ancho, alto);
}

function mostrarError(mensaje) {
    const contenedor = document.getElementById('contenedor3d');
    contenedor.innerHTML = `
        <div style="color: #ff4444; text-align: center; padding: 50px;">
            <h3>‚ùå Error en Visualizaci√≥n 3D</h3>
            <p>${mensaje}</p>
            <button onclick="location.reload()" class="boton-3d" style="margin-top: 20px;">
                üîÑ Reiniciar Sistema
            </button>
        </div>
    `;
}

// FUNCIONES DE CONTROL GLOBALES
window.cambiarVista = function(vista) {
    if (!camara) return;
    
    switch(vista) {
        case 'sistema':
            camara.position.set(0, 30, 100);
            break;
        case 'planetas_interiores':
            camara.position.set(0, 10, 30);
            break;
        case 'gigantes_gaseosos':
            camara.position.set(0, 20, 150);
            break;
        case 'lunas':
            camara.position.set(20, 5, 20);
            break;
    }
    
    mostrarNotificacion(`Vista: ${vista}`);
};

window.animar = function() {
    animacionActiva = true;
    mostrarNotificacion("Rotaci√≥n orbital activada");
};

window.pausar = function() {
    animacionActiva = false;
    mostrarNotificacion("Rotaci√≥n pausada");
};

function mostrarNotificacion(mensaje) {
    const notificacion = document.createElement('div');
    notificacion.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #00ffff;
        color: #000;
        padding: 10px 15px;
        border-radius: 5px;
        font-weight: bold;
        z-index: 1000;
        box-shadow: 0 2px 10px rgba(0,0,0,0.5);
    `;
    notificacion.textContent = mensaje;
    document.body.appendChild(notificacion);
    
    setTimeout(() => {
        if (document.body.contains(notificacion)) {
            document.body.removeChild(notificacion);
        }
    }, 2000);
}

// INICIAR SISTEMA CUANDO THREE.JS EST√â LISTO
if (typeof THREE !== 'undefined') {
    document.addEventListener('DOMContentLoaded', iniciarSistema3D);
} else {
    document.getElementById('contenedor3d').innerHTML = `
        <div style="color: #ff4444; text-align: center; padding: 50px;">
            <h3>‚ùå Three.js no disponible</h3>
            <p>La biblioteca 3D no se pudo cargar</p>
        </div>
    `;
}
</script>
</body>
</html>
