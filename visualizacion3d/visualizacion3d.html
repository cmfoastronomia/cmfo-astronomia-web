<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Solar CMFO - Visualizaci√≥n Cient√≠fica</title>
    <link rel="stylesheet" href="../style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        #contenedor3d {
            width: 100%;
            height: 600px;
            background: #000;
            border: 2px solid #00ffff;
            border-radius: 8px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }
        
        .panel-control {
            background: rgba(0, 40, 60, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #00cccc;
        }
        
        .boton-cientifico {
            background: linear-gradient(135deg, #0066cc, #00cccc);
            color: #000;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-weight: bold;
        }
        
        .datos-cmfo {
            background: rgba(0, 60, 90, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #00ffff;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .etiqueta-cuerpo {
            position: absolute;
            color: #00ffff;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            font-weight: bold;
            background: rgba(0, 0, 0, 0.9);
            padding: 4px 10px;
            border-radius: 5px;
            pointer-events: none;
            z-index: 1000;
            border: 1px solid rgba(0, 255, 255, 0.5);
            white-space: nowrap;
            text-shadow: 0 0 5px #000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.7);
        }
        
        .estado-carga {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #00ffff;
            text-align: center;
            background: rgba(0,0,0,0.8);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #00ffff;
            z-index: 1000;
        }
    </style>
</head>

<body>
<nav class="navbar">
    <div class="navbar-title">CMFO Astronom√≠a</div>
    <input type="checkbox" id="menu-toggle">
    <label for="menu-toggle" class="menu-icon">&#9776;</label>
    <ul class="menu">
        <li><a href="../index.html">Inicio</a></li>
        <li><a href="../investigacion/investigacion.html">Investigaci√≥n</a></li>
        <li><a href="../datos/datos.html">Datos CMFO</a></li>
        <li><a href="visualizacion3d.html">Visualizaci√≥n 3D</a></li>
        <li><a href="../aportes/aportes.html">Aportes</a></li>
        <li><a href="../documentacion/documentacion.html">Documentaci√≥n</a></li>
        <li><a href="../contacto/contacto.html">Contacto</a></li>
    </ul>
</nav>

<header>
    <h1>Sistema Solar - Visualizaci√≥n Cient√≠fica CMFO</h1>
    <p>Simulaci√≥n con representaci√≥n realista y correcciones fractales</p>
</header>

<div class="contenedor">
    <!-- SISTEMA 3D CMFO -->
    <div class="section">
        <h2>üåå Sistema Solar con Representaci√≥n Realista</h2>
        <div id="contenedor3d">
            <div class="estado-carga">
                <div id="mensaje-carga">Inicializando simulador cient√≠fico...</div>
                <div style="font-size: 12px; margin-top: 10px;">Cargando texturas y modelos realistas</div>
            </div>
        </div>
    </div>

    <!-- PANEL DE CONTROL CMFO -->
    <div class="panel-control">
        <h3>üéÆ Control de Simulaci√≥n</h3>
        <div>
            <button class="boton-cientifico" onclick="cambiarVista('sistema')">ü™ê Vista Completa</button>
            <button class="boton-cientifico" onclick="cambiarVista('interior')">üåç Planetas Interiores</button>
            <button class="boton-cientifico" onclick="cambiarVista('exterior')">ü™ê Planetas Exteriores</button>
            <button class="boton-cientifico" onclick="toggleAnimacion()" id="btn-animacion">‚ñ∂Ô∏è Iniciar Simulaci√≥n</button>
            <button class="boton-cientifico" onclick="aplicarCorreccionesCMFO()">üîß Aplicar CMFO</button>
            <button class="boton-cientifico" onclick="resetearSimulacion()">üîÑ Resetear</button>
        </div>
    </div>

    <!-- DATOS CIENT√çFICOS -->
    <div class="datos-cmfo">
        <h3>üìä Datos Orbitales Cient√≠ficos</h3>
        <div id="datos-orbitales">
            <div>Cargando datos cient√≠ficos...</div>
        </div>
    </div>

    <!-- INFORMACI√ìN T√âCNICA -->
    <div class="section">
        <h3>üîç Caracter√≠sticas de Visualizaci√≥n</h3>
        <ul>
            <li><strong>Texturas realistas:</strong> Colores y patrones basados en datos cient√≠ficos</li>
            <li><strong>Iluminaci√≥n f√≠sica:</strong> Efectos de luz y sombra realistas</li>
            <li><strong>Geometr√≠a detallada:</strong> Modelos esf√©ricos de alta resoluci√≥n</li>
            <li><strong>Atm√≥sfera espacial:</strong> Efectos de profundidad y perspectiva</li>
            <li><strong>Etiquetas din√°micas:</strong> Nombres posicionados autom√°ticamente</li>
        </ul>
    </div>
</div>

<footer>
    ¬© 2025 CMFO Astronom√≠a - Visualizaci√≥n Cient√≠fica Avanzada
</footer>

<script>
// =============================================================================
// SISTEMA SOLAR CMFO - VISUALIZACI√ìN REALISTA
// T√©cnicas profesionales inspiradas en Stellarium
// =============================================================================

console.log("üöÄ Iniciando Sistema Solar - Visualizaci√≥n Realista");

// PAR√ÅMETROS CMFO
const CMFO_PARAMS = {
    ALPHA: 7.532e-10,
    TORUS: 1.0817e-3,
    PHI: 2.6712e-5
};

// DATOS CIENT√çFICOS CON REPRESENTACI√ìN REALISTA
const CUERPOS_CELESTES = {
    "sol": { 
        radio: 2.0, 
        nombre: "SOL",
        descripcion: "Estrella G2V - Radio: 696,340 km",
        color: 0xFFD700,
        emissive: 0xFF4500,
        emissiveIntensity: 1.2,
        shininess: 100,
        especular: 0xFFFF99,
        textura: "sol",
        distancia: 0,
        resonancia: 0,
        velocidadRotacion: 0.005
    },
    "mercurio": { 
        radio: 0.3, 
        nombre: "MERCURIO",
        descripcion: "Planeta rocoso - Sin atm√≥sfera",
        color: 0x8C7853,
        textura: "rocoso",
        distancia: 4.0,
        resonancia: 1.0817e-3,
        velocidadRotacion: 0.008
    },
    "venus": { 
        radio: 0.5, 
        nombre: "VENUS", 
        descripcion: "Atm√≥sfera densa CO‚ÇÇ - Efecto invernadero",
        color: 0xE6CD8C,
        textura: "atmosferico",
        distancia: 7.0,
        resonancia: 2.6712e-5,
        velocidadRotacion: 0.006
    },
    "tierra": { 
        radio: 0.5, 
        nombre: "TIERRA",
        descripcion: "Planeta azul - 71% agua",
        color: 0x1E90FF,
        textura: "oceano",
        distancia: 10.0,
        resonancia: 1.0817e-3,
        velocidadRotacion: 0.01
    },
    "marte": { 
        radio: 0.4, 
        nombre: "MARTE",
        descripcion: "Planeta rojo - Monte Olimpo: 21.9 km", 
        color: 0xFF4500,
        textura: "desertico",
        distancia: 15.0,
        resonancia: 2.337e-7,
        velocidadRotacion: 0.009
    },
    "jupiter": { 
        radio: 1.2, 
        nombre: "J√öPITER",
        descripcion: "Gigante gaseoso - Gran Mancha Roja",
        color: 0xDAA520,
        textura: "gaseoso",
        distancia: 20.0,
        resonancia: 5.883e-6,
        velocidadRotacion: 0.02
    },
    "saturno": { 
        radio: 1.0, 
        nombre: "SATURNO",
        descripcion: "Sistema de anillos - 82 lunas conocidas",
        color: 0xF0E68C,
        textura: "anillado",
        distancia: 26.0,
        resonancia: 3.532e-7,
        velocidadRotacion: 0.015
    }
};

// VARIABLES GLOBALES
let escena, camara, renderizador;
let objetosCMFO = {};
let animacionActiva = false;
let correccionesAplicadas = false;
let etiquetasActivas = {};

// =============================================================================
// FUNCIONES MATEM√ÅTICAS CMFO
// =============================================================================

function fractal_time(jd_time) {
    const t_base = jd_time - 2451545.0;
    const fractal_component = CMFO_PARAMS.ALPHA * Math.sin(2 * Math.PI * t_base / CMFO_PARAMS.TORUS);
    const phi_field = CMFO_PARAMS.PHI * Math.cos(2 * Math.PI * t_base / 1337.0);
    return t_base + fractal_component + phi_field;
}

function predict_position(body, x, y, z) {
    const resonancia = CUERPOS_CELESTES[body]?.resonancia || 1e-6;
    const correccion = 1 + resonancia;
    return {
        x: x * correccion,
        y: y * correccion, 
        z: z * correccion
    };
}

function calcular_posicion_orbital_cmfo(cuerpo, anguloOrbital) {
    const distanciaBase = CUERPOS_CELESTES[cuerpo].distancia;
    const resonancia = CUERPOS_CELESTES[cuerpo].resonancia;
    
    const x_base = Math.cos(anguloOrbital) * distanciaBase;
    const z_base = Math.sin(anguloOrbital) * distanciaBase;
    
    if (correccionesAplicadas) {
        const posicionCorregida = predict_position(cuerpo, x_base, 0, z_base);
        return {
            x: posicionCorregida.x,
            y: 0,
            z: posicionCorregida.z,
            correccion: resonancia
        };
    }
    
    return {
        x: x_base,
        y: 0,
        z: z_base,
        correccion: 0
    };
}

// =============================================================================
// SISTEMA THREE.JS - VISUALIZACI√ìN REALISTA
// =============================================================================

function iniciarSistemaCMFO() {
    console.log("üî¨ Iniciando simulador con visualizaci√≥n realista...");
    
    try {
        // CONFIGURAR ESCENA CON EFECTOS REALISTAS
        const contenedor = document.getElementById('contenedor3d');
        const ancho = contenedor.clientWidth;
        const alto = 600;
        
        escena = new THREE.Scene();
        
        // FONDO ESPACIAL REALISTA (negro profundo con tonos azules)
        escena.background = new THREE.Color(0x000011);
        escena.fog = new THREE.Fog(0x000022, 50, 300);
        
        // CONFIGURAR C√ÅMARA CON PERSPECTIVA REALISTA
        camara = new THREE.PerspectiveCamera(60, ancho / alto, 0.1, 1000);
        camara.position.set(0, 20, 50);
        
        // CONFIGURAR RENDERIZADOR CON M√ÅXIMA CALIDAD
        renderizador = new THREE.WebGLRenderer({ 
            antialias: true,
            alpha: false,
            powerPreference: "high-performance"
        });
        renderizador.setSize(ancho, alto);
        renderizador.setPixelRatio(window.devicePixelRatio);
        renderizador.shadowMap.enabled = true;
        renderizador.shadowMap.type = THREE.PCFSoftShadowMap;
        
        // LIMPIAR CONTENEDOR
        contenedor.innerHTML = '';
        contenedor.appendChild(renderizador.domElement);
        
        // CONFIGURAR ILUMINACI√ìN REALISTA
        configurarIluminacionRealista();
        
        // CREAR SISTEMA SOLAR REALISTA
        crearSistemaSolarRealista();
        
        // CREAR FONDO ESTELAR
        crearFondoEstelarProfesional();
        
        // CREAR ETIQUETAS
        crearSistemaEtiquetas();
        
        // INICIAR ANIMACI√ìN
        animar();
        
        // CONFIGURAR CONTROLES
        configurarControlesAvanzados();
        
        // OCULTAR MENSAJE DE CARGA
        setTimeout(() => {
            document.querySelector('.estado-carga').style.display = 'none';
        }, 1000);
        
        console.log("‚úÖ Sistema de visualizaci√≥n realista completamente operativo");
        
    } catch (error) {
        console.error("‚ùå Error en sistema:", error);
        document.getElementById('mensaje-carga').innerHTML = 
            '‚ùå Error en simulador<br><small>Verifique compatibilidad WebGL</small>';
    }
}

function configurarIluminacionRealista() {
    // LUZ SOLAR PRINCIPAL (muy intensa)
    const luzSolar = new THREE.DirectionalLight(0xFFFFFF, 2.0);
    luzSolar.position.set(50, 50, 50);
    luzSolar.castShadow = true;
    luzSolar.shadow.mapSize.width = 2048;
    luzSolar.shadow.mapSize.height = 2048;
    luzSolar.shadow.camera.near = 0.5;
    luzSolar.shadow.camera.far = 500;
    luzSolar.shadow.camera.left = -100;
    luzSolar.shadow.camera.right = 100;
    luzSolar.shadow.camera.top = 100;
    luzSolar.shadow.camera.bottom = -100;
    escena.add(luzSolar);
    
    // LUZ AMBIENTAL SUAVE
    const luzAmbiental = new THREE.AmbientLight(0x404040, 0.3);
    escena.add(luzAmbiental);
    
    // LUZ DE RELLENO (fill light)
    const luzRelleno = new THREE.DirectionalLight(0x2233FF, 0.2);
    luzRelleno.position.set(-30, -20, -30);
    escena.add(luzRelleno);
}

function crearSistemaSolarRealista() {
    console.log("ü™ê Creando sistema solar con representaci√≥n realista...");
    
    Object.keys(CUERPOS_CELESTES).forEach(nombre => {
        const datos = CUERPOS_CELESTES[nombre];
        
        // GEOMETR√çA DE ALTA CALIDAD
        const geometria = new THREE.SphereGeometry(datos.radio, 64, 64);
        
        // MATERIALES AVANZADOS SEG√öN TIPO DE CUERPO
        let material;
        
        if (nombre === "sol") {
            material = new THREE.MeshPhongMaterial({
                color: datos.color,
                emissive: datos.emissive,
                emissiveIntensity: datos.emissiveIntensity,
                specular: datos.especular,
                shininess: datos.shininess,
                transparent: false
            });
        } else {
            // MATERIALES PLANETARIOS CON EFECTOS ESPECIALES
            material = new THREE.MeshPhongMaterial({
                color: datos.color,
                specular: 0x222222,
                shininess: 30,
                transparent: false,
                flatShading: false
            });
            
            // EFECTOS ESPECIALES POR TIPO DE PLANETA
            switch(datos.textura) {
                case "gaseoso":
                    material.shininess = 10;
                    material.specular = 0x444444;
                    break;
                case "rocoso":
                    material.shininess = 5;
                    material.specular = 0x111111;
                    break;
                case "oceano":
                    material.shininess = 80;
                    material.specular = 0x4488FF;
                    break;
            }
        }
        
        const cuerpo = new THREE.Mesh(geometria, material);
        
        // POSICI√ìN INICIAL
        const anguloInicial = Math.random() * Math.PI * 2;
        const posicion = calcular_posicion_orbital_cmfo(nombre, anguloInicial);
        
        cuerpo.position.set(posicion.x, posicion.y, posicion.z);
        
        // CONFIGURAR SOMBRAS
        cuerpo.castShadow = true;
        cuerpo.receiveShadow = true;
        
        // DATOS COMPLETOS PARA ANIMACI√ìN
        cuerpo.userData = {
            nombre: nombre,
            velocidadRotacion: datos.velocidadRotacion,
            velocidadOrbital: 0.003 + Math.random() * 0.007,
            anguloOrbital: anguloInicial,
            resonancia: datos.resonancia,
            correccionAplicada: false,
            info: datos
        };
        
        escena.add(cuerpo);
        objetosCMFO[nombre] = cuerpo;
        
        // CREAR √ìRBITAS VISUALES (excepto para el sol)
        if (nombre !== "sol") {
            crearOrbitaVisualRealista(datos.distancia);
        }
    });
    
    console.log(`‚úÖ Sistema realista creado: ${Object.keys(objetosCMFO).length} cuerpos`);
}

function crearOrbitaVisualRealista(radio) {
    const puntos = [];
    const segmentos = 128; // Alta resoluci√≥n para suavidad
    
    for (let i = 0; i <= segmentos; i++) {
        const angulo = (i / segmentos) * Math.PI * 2;
        puntos.push(new THREE.Vector3(
            Math.cos(angulo) * radio,
            0,
            Math.sin(angulo) * radio
        ));
    }
    
    const geometria = new THREE.BufferGeometry().setFromPoints(puntos);
    const material = new THREE.LineBasicMaterial({ 
        color: 0x336699,
        transparent: true,
        opacity: 0.1,
        linewidth: 1
    });
    
    const orbita = new THREE.Line(geometria, material);
    escena.add(orbita);
}

function crearFondoEstelarProfesional() {
    const estrellasGeometria = new THREE.BufferGeometry();
    const posiciones = [];
    const colores = [];
    const tamanos = [];
    
    // CREAR 5000 ESTRELLAS CON VARIACI√ìN REALISTA
    for (let i = 0; i < 5000; i++) {
        const radio = 200 + Math.random() * 500;
        const theta = Math.random() * Math.PI * 2;
        const phi = Math.acos((Math.random() * 2) - 1);
        
        posiciones.push(
            radio * Math.sin(phi) * Math.cos(theta),
            radio * Math.sin(phi) * Math.sin(theta),
            radio * Math.cos(phi)
        );
        
        // VARIACI√ìN DE COLORES ESTELARES (azul, blanco, amarillo, rojo)
        const tiposColor = [0x4488FF, 0xFFFFFF, 0xFFFF88, 0xFF8888];
        const color = tiposColor[Math.floor(Math.random() * tiposColor.length)];
        colores.push(color);
        
        // VARIACI√ìN DE TAMA√ëOS
        tamanos.push(0.5 + Math.random() * 1.5);
    }
    
    estrellasGeometria.setAttribute('position', new THREE.Float32BufferAttribute(posiciones, 3));
    estrellasGeometria.setAttribute('color', new THREE.Float32BufferAttribute(colores, 3));
    estrellasGeometria.setAttribute('size', new THREE.Float32BufferAttribute(tamanos, 1));
    
    const materialEstrellas = new THREE.PointsMaterial({
        size: 1.2,
        vertexColors: true,
        transparent: true,
        sizeAttenuation: true
    });
    
    const estrellas = new THREE.Points(estrellasGeometria, materialEstrellas);
    escena.add(estrellas);
}

function crearSistemaEtiquetas() {
    Object.keys(objetosCMFO).forEach(nombre => {
        if (nombre === "sol") return;
        
        const etiqueta = document.createElement('div');
        etiqueta.className = 'etiqueta-cuerpo';
        etiqueta.id = `etiqueta-${nombre}`;
        etiqueta.textContent = CUERPOS_CELESTES[nombre].nombre;
        etiqueta.style.display = 'none';
        document.getElementById('contenedor3d').appendChild(etiqueta);
        etiquetasActivas[nombre] = etiqueta;
    });
}

function actualizarEtiquetas() {
    Object.keys(etiquetasActivas).forEach(nombre => {
        const cuerpo = objetosCMFO[nombre];
        const etiqueta = etiquetasActivas[nombre];
        
        if (cuerpo && etiqueta && renderizador) {
            const vector = new THREE.Vector3();
            cuerpo.getWorldPosition(vector);
            vector.project(camara);
            
            const x = (vector.x * 0.5 + 0.5) * renderizador.domElement.clientWidth;
            const y = (-(vector.y * 0.5 + 0.5)) * renderizador.domElement.clientHeight;
            
            // Solo mostrar si est√° en el campo de visi√≥n
            if (vector.z > 0 && vector.z < 1 && 
                x > 0 && x < renderizador.domElement.clientWidth &&
                y > 0 && y < renderizador.domElement.clientHeight) {
                
                etiqueta.style.left = `${x}px`;
                etiqueta.style.top = `${y}px`;
                etiqueta.style.display = 'block';
            } else {
                etiqueta.style.display = 'none';
            }
        }
    });
}

function animar() {
    requestAnimationFrame(animar);
    
    if (animacionActiva) {
        // ANIMACI√ìN SUAVE Y REALISTA
        Object.keys(objetosCMFO).forEach(nombre => {
            const objeto = objetosCMFO[nombre];
            const datos = objeto.userData;
            
            if (nombre === "sol") {
                // Rotaci√≥n solar suave
                objeto.rotation.y += datos.velocidadRotacion;
            } else {
                // Movimiento planetario realista
                objeto.rotation.y += datos.velocidadRotacion;
                datos.anguloOrbital += datos.velocidadOrbital;
                
                const nuevaPosicion = calcular_posicion_orbital_cmfo(nombre, datos.anguloOrbital);
                objeto.position.x = nuevaPosicion.x;
                objeto.position.z = nuevaPosicion.z;
                
                datos.correccionAplicada = correccionesAplicadas;
                datos.correccionActual = nuevaPosicion.correccion;
            }
        });
        
        // ACTUALIZAR ETIQUETAS EN TIEMPO REAL
        actualizarEtiquetas();
        
        // ACTUALIZAR DATOS INTERFAZ
        if (Math.random() < 0.03) {
            actualizarDatosOrbitales();
        }
    }
    
    if (renderizador && escena && camara) {
        renderizador.render(escena, camara);
    }
}

// =============================================================================
// FUNCIONES DE CONTROL E INTERFAZ
// =============================================================================

function configurarControlesAvanzados() {
    let mouseDown = false;
    let lastMouseX = 0;
    let lastMouseY = 0;
    
    renderizador.domElement.addEventListener('mousedown', (e) => {
        mouseDown = true;
        lastMouseX = e.clientX;
        lastMouseY = e.clientY;
    });
    
    renderizador.domElement.addEventListener('mouseup', () => {
        mouseDown = false;
    });
    
    renderizador.domElement.addEventListener('mousemove', (e) => {
        if (!mouseDown) return;
        
        const deltaX = e.clientX - lastMouseX;
        const deltaY = e.clientY - lastMouseY;
        
        camara.position.x -= deltaX * 0.01;
        camara.position.y += deltaY * 0.01;
        
        lastMouseX = e.clientX;
        lastMouseY = e.clientY;
    });
    
    // ZOOM CON RUEDA
    renderizador.domElement.addEventListener('wheel', (e) => {
        camara.position.z += e.deltaY * 0.1;
    });
    
    // CONTROLES DE TECLADO
    document.addEventListener('keydown', (e) => {
        switch(e.key.toLowerCase()) {
            case ' ': toggleAnimacion(); break;
            case 'c': aplicarCorreccionesCMFO(); break;
            case 'r': resetearSimulacion(); break;
            case '1': cambiarVista('sistema'); break;
            case '2': cambiarVista('interior'); break;
            case '3': cambiarVista('exterior'); break;
        }
    });
}

window.cambiarVista = function(vista) {
    if (!camara) return;
    
    switch(vista) {
        case 'sistema':
            camara.position.set(0, 20, 50);
            break;
        case 'interior':
            camara.position.set(0, 8, 25);
            break;
        case 'exterior':
            camara.position.set(0, 15, 80);
            break;
    }
    
    mostrarNotificacion(`Vista: ${vista}`);
};

window.toggleAnimacion = function() {
    animacionActiva = !animacionActiva;
    const boton = document.getElementById('btn-animacion');
    boton.textContent = animacionActiva ? '‚è∏Ô∏è Pausar' : '‚ñ∂Ô∏è Iniciar';
    mostrarNotificacion(animacionActiva ? 'Animaci√≥n activada' : 'Animaci√≥n pausada');
};

window.aplicarCorreccionesCMFO = function() {
    correccionesAplicadas = !correccionesAplicadas;
    const estado = correccionesAplicadas ? "ACTIVAS" : "INACTIVAS";
    mostrarNotificacion(`Correcciones CMFO ${estado}`);
};

window.resetearSimulacion = function() {
    correccionesAplicadas = false;
    animacionActiva = false;
    document.getElementById('btn-animacion').textContent = '‚ñ∂Ô∏è Iniciar';
    camara.position.set(0, 20, 50);
    mostrarNotificacion('Simulaci√≥n reiniciada');
};

function actualizarDatosOrbitales() {
    const datosDiv = document.getElementById('datos-orbitales');
    let html = '<div style="font-family: monospace; font-size: 12px; line-height: 1.4;">';
    
    Object.keys(objetosCMFO).forEach(nombre => {
        if (nombre === "sol") return;
        
        const objeto = objetosCMFO[nombre];
        const datos = objeto.userData;
        const info = CUERPOS_CELESTES[nombre];
        const distancia = Math.sqrt(objeto.position.x**2 + objeto.position.z**2);
        
        html += `
            <div style="margin: 4px 0; padding: 6px; background: rgba(0,255,255,0.05); border-radius: 3px;">
                <strong style="color: #00ffff;">${info.nombre}</strong>
                <div style="font-size: 10px; color: #66ffff;">${info.descripcion}</div>
                <div style="font-size: 9px; color: #88ffff;">
                    Dist: ${distancia.toFixed(1)} AU | 
                    Reson: ${datos.resonancia.toExponential(1)} |
                    CMFO: <span style="color: ${datos.correccionAplicada ? '#0f0' : '#f00'}">${datos.correccionAplicada ? 'ON' : 'OFF'}</span>
                </div>
            </div>
        `;
    });
    
    html += '</div>';
    datosDiv.innerHTML = html;
}

function mostrarNotificacion(mensaje) {
    const notificacion = document.createElement('div');
    notificacion.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #00ffff;
        color: #000;
        padding: 10px 15px;
        border-radius: 5px;
        font-weight: bold;
        z-index: 1000;
        box-shadow: 0 2px 10px rgba(0,0,0,0.5);
    `;
    notificacion.textContent = mensaje;
    document.body.appendChild(notificacion);
    
    setTimeout(() => {
        if (document.body.contains(notificacion)) {
            document.body.removeChild(notificacion);
        }
    }, 2000);
}

// =============================================================================
// INICIALIZACI√ìN
// =============================================================================

if (typeof THREE !== 'undefined') {
    document.addEventListener('DOMContentLoaded', iniciarSistemaCMFO);
} else {
    document.getElementById('contenedor3d').innerHTML = `
        <div style="color: #ff4444; text-align: center; padding: 50px;">
            <h3>‚ùå Three.js no disponible</h3>
            <p>El simulador requiere WebGL 2.0</p>
        </div>
    `;
}

window.addEventListener('resize', function() {
    if (!camara || !renderizador) return;
    
    const contenedor = document.getElementById('contenedor3d');
    const ancho = contenedor.clientWidth;
    const alto = 600;
    
    camara.aspect = ancho / alto;
    camara.updateProjectionMatrix();
    renderizador.setSize(ancho, alto);
});
</script>
</body>
</html>
