<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Solar Realista - CMFO Astronom√≠a</title>
    <link rel="stylesheet" href="../style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        #contenedor3d {
            width: 100%;
            height: 600px;
            background: #000;
            border: 2px solid #00ffff;
            border-radius: 8px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }
        
        .etiqueta-cuerpo {
            position: absolute;
            color: #00ffff;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            font-weight: bold;
            background: rgba(0, 0, 0, 0.95);
            padding: 6px 12px;
            border-radius: 8px;
            pointer-events: none;
            z-index: 1000;
            border: 2px solid rgba(0, 255, 255, 0.7);
            white-space: nowrap;
            text-shadow: 0 0 8px #000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.8);
            transform: translate(-50%, -100%);
            margin-top: -10px;
        }
        
        .panel-control {
            background: rgba(0, 40, 60, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #00cccc;
        }
        
        .boton-control {
            background: linear-gradient(135deg, #0066cc, #00cccc);
            color: #000;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-weight: bold;
        }
        
        .estado-carga {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #00ffff;
            text-align: center;
            background: rgba(0,0,0,0.9);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #00ffff;
            z-index: 1000;
        }
    </style>
</head>

<body>
<nav class="navbar">
    <div class="navbar-title">CMFO Astronom√≠a</div>
    <input type="checkbox" id="menu-toggle">
    <label for="menu-toggle" class="menu-icon">&#9776;</label>
    <ul class="menu">
        <li><a href="../index.html">Inicio</a></li>
        <li><a href="../investigacion/investigacion.html">Investigaci√≥n</a></li>
        <li><a href="../datos/datos.html">Datos CMFO</a></li>
        <li><a href="visualizacion3d.html">Visualizaci√≥n 3D</a></li>
        <li><a href="../aportes/aportes.html">Aportes</a></li>
        <li><a href="../documentacion/documentacion.html">Documentaci√≥n</a></li>
        <li><a href="../contacto/contacto.html">Contacto</a></li>
    </ul>
</nav>

<header>
    <h1>Sistema Solar - Representaci√≥n Cient√≠fica Realista</h1>
    <p>Texturas procedurales generadas en tiempo real - Modelo CMFO</p>
</header>

<div class="contenedor">
    <div class="section">
        <h2>üåå Sistema Solar con Texturas Procedurales</h2>
        <div id="contenedor3d">
            <div class="estado-carga">
                <div id="mensaje-carga">Generando texturas realistas...</div>
                <div style="font-size: 12px; margin-top: 10px;">Por favor espere</div>
            </div>
        </div>
    </div>

    <div class="panel-control">
        <h3>üéÆ Control de Visualizaci√≥n</h3>
        <button class="boton-control" onclick="cambiarVista('completa')">ü™ê Vista Completa</button>
        <button class="boton-control" onclick="cambiarVista('interior')">üåç Planetas Interiores</button>
        <button class="boton-control" onclick="cambiarVista('gigantes')">ü™ê Gigantes Gaseosos</button>
        <button class="boton-control" onclick="toggleAnimacion()" id="btnAnimacion">‚ñ∂Ô∏è Iniciar Animaci√≥n</button>
        <button class="boton-control" onclick="toggleCMFO()" id="btnCMFO">üîß CMFO: OFF</button>
    </div>
</div>

<footer>
    ¬© 2025 CMFO Astronom√≠a - Visualizaci√≥n Cient√≠fica
</footer>

<script>
// =============================================================================
// SISTEMA SOLAR PROFESIONAL - TEXTURAS PROCEDURALES
// =============================================================================

let escena, camara, renderizador;
let animacionActiva = false;
let cmfoActivo = false;
const objetos = {};
const etiquetas = {};

// CONFIGURACI√ìN CIENT√çFICA
const CUERPOS_CELESTES = {
    sol: {
        radio: 3.0,
        nombre: "SOL",
        tipo: "estrella",
        colorBase: [1.0, 0.9, 0.1],
        colorEmisivo: [1.0, 0.4, 0.1],
        distancia: 0,
        velocidadRotacion: 0.002,
        detalles: "Estrella G2V - N√∫cleo de fusi√≥n"
    },
    mercurio: {
        radio: 0.8,
        nombre: "MERCURIO", 
        tipo: "rocoso",
        colorBase: [0.6, 0.5, 0.4],
        colorSecundario: [0.4, 0.3, 0.2],
        distancia: 8,
        velocidadRotacion: 0.008,
        detalles: "Planeta rocoso - Superficie craterizada"
    },
    venus: {
        radio: 1.2,
        nombre: "VENUS",
        tipo: "atmosferico", 
        colorBase: [0.9, 0.7, 0.3],
        colorAtmosfera: [1.0, 0.8, 0.5],
        distancia: 12,
        velocidadRotacion: 0.006,
        detalles: "Atm√≥sfera densa CO‚ÇÇ - Efecto invernadero extremo"
    },
    tierra: {
        radio: 1.3,
        nombre: "TIERRA",
        tipo: "oceano",
        colorBase: [0.2, 0.4, 0.8],
        colorContinentes: [0.3, 0.6, 0.2],
        distancia: 16,
        velocidadRotacion: 0.01,
        detalles: "Planeta azul - 71% agua - √önico con vida"
    },
    marte: {
        radio: 0.9,
        nombre: "MARTE",
        tipo: "desertico",
        colorBase: [0.8, 0.3, 0.1],
        colorSecundario: [0.6, 0.2, 0.05],
        distancia: 20,
        velocidadRotacion: 0.009,
        detalles: "Planeta rojo - Monte Olimpo: 21.9 km"
    },
    jupiter: {
        radio: 2.8,
        nombre: "J√öPITER",
        tipo: "gaseoso",
        colorBase: [0.9, 0.7, 0.4],
        colorBandas: [0.7, 0.5, 0.3],
        distancia: 28,
        velocidadRotacion: 0.025,
        detalles: "Gigante gaseoso - Gran Mancha Roja"
    },
    saturno: {
        radio: 2.4,
        nombre: "SATURNO",
        tipo: "anillado",
        colorBase: [0.95, 0.85, 0.6],
        colorAnillos: [0.8, 0.7, 0.5],
        distancia: 36,
        velocidadRotacion: 0.02,
        detalles: "Sistema de anillos - 82 lunas conocidas"
    }
};

function iniciarSistema() {
    console.log("üöÄ Iniciando sistema solar realista...");
    
    // CONFIGURACI√ìN THREE.JS
    const contenedor = document.getElementById('contenedor3d');
    
    escena = new THREE.Scene();
    escena.background = new THREE.Color(0x000011);
    escena.fog = new THREE.Fog(0x000022, 50, 200);
    
    camara = new THREE.PerspectiveCamera(60, contenedor.clientWidth / 600, 0.1, 1000);
    camara.position.set(0, 15, 50);
    
    renderizador = new THREE.WebGLRenderer({ 
        antialias: true,
        powerPreference: "high-performance"
    });
    renderizador.setSize(contenedor.clientWidth, 600);
    renderizador.shadowMap.enabled = true;
    renderizador.shadowMap.type = THREE.PCFSoftShadowMap;
    contenedor.appendChild(renderizador.domElement);
    
    // ILUMINACI√ìN PROFESIONAL
    const luzSolar = new THREE.DirectionalLight(0xffffff, 1.5);
    luzSolar.position.set(50, 50, 50);
    luzSolar.castShadow = true;
    luzSolar.shadow.mapSize.width = 2048;
    luzSolar.shadow.mapSize.height = 2048;
    escena.add(luzSolar);
    
    const luzAmbiental = new THREE.AmbientLight(0x404040, 0.3);
    escena.add(luzAmbiental);
    
    // CREAR SISTEMA SOLAR
    crearSistemaSolar();
    
    // FONDO ESTELAR
    crearFondoEstelar();
    
    // INICIAR ANIMACI√ìN
    animar();
    
    // CONTROLES
    configurarControles();
    
    // OCULTAR CARGA
    setTimeout(() => {
        document.querySelector('.estado-carga').style.display = 'none';
    }, 2000);
    
    console.log("‚úÖ Sistema solar completamente operativo");
}

function crearTexturaProcedural(tipo, config) {
    const canvas = document.createElement('canvas');
    const size = 1024;
    canvas.width = size;
    canvas.height = size;
    const ctx = canvas.getContext('2d');
    
    // FONDO BASE
    ctx.fillStyle = `rgb(${config.colorBase[0]*255}, ${config.colorBase[1]*255}, ${config.colorBase[2]*255})`;
    ctx.fillRect(0, 0, size, size);
    
    switch(tipo) {
        case "estrella":
            crearTexturaEstrella(ctx, size, config);
            break;
        case "rocoso":
            crearTexturaRocoso(ctx, size, config);
            break;
        case "gaseoso":
            crearTexturaGaseoso(ctx, size, config);
            break;
        case "oceano":
            crearTexturaOceano(ctx, size, config);
            break;
        case "atmosferico":
            crearTexturaAtmosferico(ctx, size, config);
            break;
    }
    
    const textura = new THREE.CanvasTexture(canvas);
    textura.wrapS = THREE.RepeatWrapping;
    textura.wrapT = THREE.RepeatWrapping;
    return textura;
}

function crearTexturaEstrella(ctx, size, config) {
    const gradient = ctx.createRadialGradient(size/2, size/2, 0, size/2, size/2, size/2);
    gradient.addColorStop(0, `rgb(255, 255, 200)`);
    gradient.addColorStop(0.2, `rgb(255, 220, 120)`);
    gradient.addColorStop(0.4, `rgb(255, 180, 80)`);
    gradient.addColorStop(0.7, `rgb(255, 120, 40)`);
    gradient.addColorStop(1, `rgb(180, 60, 0)`);
    
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, size, size);
    
    // EFECTO DE GRANULACI√ìN SOLAR
    for (let i = 0; i < 2000; i++) {
        const x = Math.random() * size;
        const y = Math.random() * size;
        const radio = Math.random() * 4;
        const brillo = 180 + Math.random() * 75;
        ctx.fillStyle = `rgb(${brillo}, ${brillo-20}, ${brillo-40})`;
        ctx.beginPath();
        ctx.arc(x, y, radio, 0, Math.PI * 2);
        ctx.fill();
    }
    
    // PROTUBERANCIAS SOLARES
    for (let i = 0; i < 100; i++) {
        const angulo = Math.random() * Math.PI * 2;
        const distancia = size * 0.3 + Math.random() * size * 0.2;
        const x = size/2 + Math.cos(angulo) * distancia;
        const y = size/2 + Math.sin(angulo) * distancia;
        const radio = 5 + Math.random() * 15;
        
        ctx.fillStyle = `rgb(255, ${100 + Math.random() * 100}, 0)`;
        ctx.beginPath();
        ctx.arc(x, y, radio, 0, Math.PI * 2);
        ctx.fill();
    }
}

function crearTexturaRocoso(ctx, size, config) {
    // CR√ÅTERES DETALLADOS
    for (let i = 0; i < 800; i++) {
        const x = Math.random() * size;
        const y = Math.random() * size;
        const radio = 1 + Math.random() * 25;
        
        // SOMBRA DEL CR√ÅTER
        ctx.fillStyle = `rgb(${config.colorSecundario[0]*255}, ${config.colorSecundario[1]*255}, ${config.colorSecundario[2]*255})`;
        ctx.beginPath();
        ctx.arc(x, y, radio, 0, Math.PI * 2);
        ctx.fill();
        
        // BORDE ILUMINADO
        ctx.strokeStyle = `rgb(${config.colorBase[0]*255 + 50}, ${config.colorBase[1]*255 + 50}, ${config.colorBase[2]*255 + 50})`;
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.arc(x, y, radio, 0, Math.PI * 2);
        ctx.stroke();
        
        // PICO CENTRAL
        if (radio > 8) {
            ctx.fillStyle = `rgb(${config.colorBase[0]*255 + 30}, ${config.colorBase[1]*255 + 30}, ${config.colorBase[2]*255 + 30})`;
            ctx.beginPath();
            ctx.arc(x, y, radio/3, 0, Math.PI * 2);
            ctx.fill();
        }
    }
    
    // MONTA√ëAS Y ACCIDENTES
    for (let i = 0; i < 200; i++) {
        const x = Math.random() * size;
        const y = Math.random() * size;
        const altura = 3 + Math.random() * 12;
        const ancho = 2 + Math.random() * 8;
        
        ctx.fillStyle = `rgb(${config.colorBase[0]*255 + 20}, ${config.colorBase[1]*255 + 20}, ${config.colorBase[2]*255 + 20})`;
        ctx.fillRect(x, y, ancho, altura);
    }
}

function crearTexturaGaseoso(ctx, size, config) {
    // BANDAS ATMOSF√âRICAS HORIZONTALES
    for (let i = 0; i < 20; i++) {
        const y = Math.random() * size;
        const altura = 10 + Math.random() * 50;
        const intensidad = 0.4 + Math.random() * 0.6;
        
        ctx.fillStyle = `rgb(
            ${config.colorBandas[0]*255 * intensidad}, 
            ${config.colorBandas[1]*255 * intensidad}, 
            ${config.colorBandas[2]*255 * intensidad}
        )`;
        ctx.fillRect(0, y, size, altura);
    }
    
    // GRAN MANCHA ROJA (J√öPITER)
    if (config.nombre === "J√öPITER") {
        ctx.fillStyle = 'rgb(200, 100, 80)';
        ctx.beginPath();
        ctx.ellipse(size * 0.7, size * 0.4, 60, 30, 0, 0, Math.PI * 2);
        ctx.fill();
        
        // DETALLES DE LA MANCHA
        ctx.fillStyle = 'rgb(180, 80, 60)';
        ctx.beginPath();
        ctx.ellipse(size * 0.7, size * 0.4, 40, 20, 0, 0, Math.PI * 2);
        ctx.fill();
    }
    
    // REMOLINOS ATMOSF√âRICOS
    for (let i = 0; i < 50; i++) {
        const x = Math.random() * size;
        const y = Math.random() * size;
        const radio = 5 + Math.random() * 20;
        
        ctx.strokeStyle = `rgb(
            ${config.colorBandas[0]*255 * 0.8}, 
            ${config.colorBandas[1]*255 * 0.8}, 
            ${config.colorBandas[2]*255 * 0.8}
        )`;
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.arc(x, y, radio, 0, Math.PI * 1.5);
        ctx.stroke();
    }
}

function crearTexturaOceano(ctx, size, config) {
    // CONTINENTES PRINCIPALES
    for (let i = 0; i < 6; i++) {
        const x = size * 0.1 + Math.random() * size * 0.8;
        const y = size * 0.1 + Math.random() * size * 0.8;
        const radio = 40 + Math.random() * 80;
        
        // CONTINENTE BASE
        ctx.fillStyle = `rgb(${config.colorContinentes[0]*255}, ${config.colorContinentes[1]*255}, ${config.colorContinentes[2]*255})`;
        ctx.beginPath();
        ctx.arc(x, y, radio, 0, Math.PI * 2);
        ctx.fill();
        
        // CADENAS MONTA√ëOSAS
        for (let j = 0; j < 8; j++) {
            const angulo = Math.random() * Math.PI * 2;
            const distancia = Math.random() * radio * 0.8;
            const mx = x + Math.cos(angulo) * distancia;
            const my = y + Math.sin(angulo) * distancia;
            
            ctx.fillStyle = `rgb(${config.colorContinentes[0]*255 - 30}, ${config.colorContinentes[1]*255 - 30}, ${config.colorContinentes[2]*255 - 30})`;
            ctx.beginPath();
            ctx.arc(mx, my, 8 + Math.random() * 15, 0, Math.PI * 2);
            ctx.fill();
        }
        
        // COSTAS DETALLADAS
        ctx.strokeStyle = `rgb(${config.colorContinentes[0]*255 - 15}, ${config.colorContinentes[1]*255 - 15}, ${config.colorContinentes[2]*255 - 15})`;
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.arc(x, y, radio, 0, Math.PI * 2);
        ctx.stroke();
    }
    
    // NUBES
    for (let i = 0; i < 100; i++) {
        const x = Math.random() * size;
        const y = Math.random() * size;
        const radio = 5 + Math.random() * 20;
        
        ctx.fillStyle = `rgba(255, 255, 255, ${0.3 + Math.random() * 0.4})`;
        ctx.beginPath();
        ctx.arc(x, y, radio, 0, Math.PI * 2);
        ctx.fill();
    }
}

function crearTexturaAtmosferico(ctx, size, config) {
    // NUBES ESPESAS Y CAPAS
    for (let capa = 0; capa < 3; capa++) {
        for (let i = 0; i < 80; i++) {
            const x = Math.random() * size;
            const y = Math.random() * size;
            const radio = 15 + Math.random() * 35;
            const opacidad = 0.2 + (capa * 0.2) + Math.random() * 0.3;
            
            ctx.fillStyle = `rgba(${config.colorAtmosfera[0]*255}, ${config.colorAtmosfera[1]*255}, ${config.colorAtmosfera[2]*255}, ${opacidad})`;
            ctx.beginPath();
            ctx.arc(x, y, radio, 0, Math.PI * 2);
            ctx.fill();
        }
    }
    
    // EFECTO DE BRUMA GLOBAL
    const gradient = ctx.createRadialGradient(size/2, size/2, size*0.3, size/2, size/2, size*0.8);
    gradient.addColorStop(0, 'rgba(255, 255, 255, 0)');
    gradient.addColorStop(1, `rgba(${config.colorAtmosfera[0]*255}, ${config.colorAtmosfera[1]*255}, ${config.colorAtmosfera[2]*255}, 0.3)`);
    
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, size, size);
}

function crearSistemaSolar() {
    Object.keys(CUERPOS_CELESTES).forEach(nombre => {
        const cuerpo = CUERPOS_CELESTES[nombre];
        
        // CREAR TEXTURA PROCEDURAL
        const textura = crearTexturaProcedural(cuerpo.tipo, cuerpo);
        
        // GEOMETR√çA DE ALTA RESOLUCI√ìN
        const geometria = new THREE.SphereGeometry(cuerpo.radio, 128, 128);
        
        // MATERIAL AVANZADO
        let material;
        if (nombre === "sol") {
            material = new THREE.MeshPhongMaterial({
                map: textura,
                emissive: new THREE.Color(...cuerpo.colorEmisivo),
                emissiveIntensity: 1.2,
                shininess: 120
            });
        } else {
            material = new THREE.MeshPhongMaterial({
                map: textura,
                shininess: cuerpo.tipo === "gaseoso" ? 10 : 30,
                specular: 0x333333
            });
        }
        
        const mesh = new THREE.Mesh(geometria, material);
        
        // POSICI√ìN INICIAL
        const angulo = Math.random() * Math.PI * 2;
        mesh.position.x = Math.cos(angulo) * cuerpo.distancia;
        mesh.position.z = Math.sin(angulo) * cuerpo.distancia;
        
        // PROPIEDADES F√çSICAS
        mesh.castShadow = true;
        mesh.receiveShadow = true;
        
        // DATOS DE ANIMACI√ìN
        mesh.userData = {
            nombre: nombre,
            velocidadRotacion: cuerpo.velocidadRotacion,
            velocidadOrbital: 0.002 + Math.random() * 0.003,
            anguloOrbital: angulo,
            distanciaOrbital: cuerpo.distancia
        };
        
        escena.add(mesh);
        objetos[nombre] = mesh;
        
        // CREAR ETIQUETA INMEDIATAMENTE
        crearEtiqueta(nombre);
        
        // √ìRBITA VISUAL (excepto sol)
        if (nombre !== "sol") {
            crearOrbitaVisual(cuerpo.distancia);
        }
        
        // ANILLOS DE SATURNO
        if (nombre === "saturno") {
            crearAnillosSaturno(mesh.position, cuerpo.radio);
        }
        
        console.log(`‚úÖ ${cuerpo.nombre} creado`);
    });
}

function crearAnillosSaturno(posicion, radioPlaneta) {
    const geometriaAnillos = new THREE.RingGeometry(radioPlaneta * 1.5, radioPlaneta * 2.5, 64);
    const texturaAnillos = crearTexturaAnillos();
    
    const materialAnillos = new THREE.MeshBasicMaterial({
        map: texturaAnillos,
        side: THREE.DoubleSide,
        transparent: true,
        opacity: 0.8
    });
    
    const anillos = new THREE.Mesh(geometriaAnillos, materialAnillos);
    anillos.rotation.x = Math.PI / 2;
    anillos.position.copy(posicion);
    escena.add(anillos);
    objetos.anillosSaturno = anillos;
}

function crearTexturaAnillos() {
    const canvas = document.createElement('canvas');
    const size = 512;
    canvas.width = size;
    canvas.height = size;
    const ctx = canvas.getContext('2d');
    
    // ANILLOS CON BANDAS
    for (let i = 0; i < 5; i++) {
        const radioInterno = size * 0.2 + i * size * 0.1;
        const radioExterno = radioInterno + size * 0.08;
        const opacidad = 0.3 + Math.random() * 0.5;
        
        const gradient = ctx.createRadialGradient(size/2, size/2, radioInterno, size/2, size/2, radioExterno);
        gradient.addColorStop(0, `rgba(200, 180, 120, ${opacidad})`);
        gradient.addColorStop(1, `rgba(160, 140, 100, ${opacidad * 0.7})`);
        
        ctx.fillStyle = gradient;
        ctx.beginPath();
        ctx.arc(size/2, size/2, radioExterno, 0, Math.PI * 2);
        ctx.arc(size/2, size/2, radioInterno, 0, Math.PI * 2, true);
        ctx.fill();
    }
    
    return new THREE.CanvasTexture(canvas);
}

function crearOrbitaVisual(radio) {
    const puntos = [];
    const segmentos = 128;
    
    for (let i = 0; i <= segmentos; i++) {
        const angulo = (i / segmentos) * Math.PI * 2;
        puntos.push(new THREE.Vector3(
            Math.cos(angulo) * radio,
            0,
            Math.sin(angulo) * radio
        ));
    }
    
    const geometria = new THREE.BufferGeometry().setFromPoints(puntos);
    const material = new THREE.LineBasicMaterial({ 
        color: 0x336699,
        transparent: true,
        opacity: 0.15
    });
    
    const orbita = new THREE.Line(geometria, material);
    escena.add(orbita);
}

function crearFondoEstelar() {
    const estrellasGeometria = new THREE.BufferGeometry();
    const posiciones = [];
    const colores = [];
    const tamanos = [];
    
    for (let i = 0; i < 4000; i++) {
        const radio = 100 + Math.random() * 500;
        const theta = Math.random() * Math.PI * 2;
        const phi = Math.acos((Math.random() * 2) - 1);
        
        posiciones.push(
            radio * Math.sin(phi) * Math.cos(theta),
            radio * Math.sin(phi) * Math.sin(theta),
            radio * Math.cos(phi)
        );
        
        const tiposColor = [0x4488FF, 0xFFFFFF, 0xFFFF88, 0xFF8888];
        const color = tiposColor[Math.floor(Math.random() * tiposColor.length)];
        colores.push(color);
        tamanos.push(0.5 + Math.random() * 2.0);
    }
    
    estrellasGeometria.setAttribute('position', new THREE.Float32BufferAttribute(posiciones, 3));
    estrellasGeometria.setAttribute('color', new THREE.Float32BufferAttribute(colores, 3));
    estrellasGeometria.setAttribute('size', new THREE.Float32BufferAttribute(tamanos, 1));
    
    const materialEstrellas = new THREE.PointsMaterial({
        size: 1.5,
        vertexColors: true,
        sizeAttenuation: true,
        transparent: true
    });
    
    const estrellas = new THREE.Points(estrellasGeometria, materialEstrellas);
    escena.add(estrellas);
}

function crearEtiqueta(nombre) {
    const etiqueta = document.createElement('div');
    etiqueta.className = 'etiqueta-cuerpo';
    etiqueta.id = `etiqueta-${nombre}`;
    etiqueta.textContent = CUERPOS_CELESTES[nombre].nombre;
    etiqueta.style.display = 'none';
    document.getElementById('contenedor3d').appendChild(etiqueta);
    etiquetas[nombre] = etiqueta;
}

function actualizarEtiquetas() {
    Object.keys(etiquetas).forEach(nombre => {
        const cuerpo = objetos[nombre];
        const etiqueta = etiquetas[nombre];
        
        if (cuerpo && etiqueta && renderizador) {
            const vector = new THREE.Vector3();
            cuerpo.getWorldPosition(vector);
            vector.project(camara);
            
            // CONVERTIR COORDENADAS 3D A 2D
            const x = (vector.x * 0.5 + 0.5) * renderizador.domElement.clientWidth;
            const y = (-(vector.y * 0.5 + 0.5)) * renderizador.domElement.clientHeight;
            
            // SOLO MOSTRAR SI EST√Å EN CAMPO DE VISI√ìN
            if (vector.z > 0 && vector.z < 1 && 
                x > -100 && x < renderizador.domElement.clientWidth + 100 &&
                y > -100 && y < renderizador.domElement.clientHeight + 100) {
                
                etiqueta.style.left = `${x}px`;
                etiqueta.style.top = `${y}px`;
                etiqueta.style.display = 'block';
                
                // EVITAR QUE SE SALGA DE LA PANTALLA
                if (x < 80) etiqueta.style.left = '80px';
                if (x > renderizador.domElement.clientWidth - 120) 
                    etiqueta.style.left = `${renderizador.domElement.clientWidth - 120}px`;
                if (y < 50) etiqueta.style.top = '50px';
                if (y > renderizador.domElement.clientHeight - 40) 
                    etiqueta.style.top = `${renderizador.domElement.clientHeight - 40}px`;
                    
            } else {
                etiqueta.style.display = 'none';
            }
        }
    });
}

function animar() {
    requestAnimationFrame(animar);
    
    if (animacionActiva) {
        Object.keys(objetos).forEach(nombre => {
            const objeto = objetos[nombre];
            const datos = objeto.userData;
            
            if (datos) {
                // ROTACI√ìN
                objeto.rotation.y += datos.velocidadRotacion;
                
                // TRASLACI√ìN ORBITAL
                if (nombre !== "sol" && nombre !== "anillosSaturno") {
                    datos.anguloOrbital += datos.velocidadOrbital;
                    objeto.position.x = Math.cos(datos.anguloOrbital) * datos.distanciaOrbital;
                    objeto.position.z = Math.sin(datos.anguloOrbital) * datos.distanciaOrbital;
                    
                    // ACTUALIZAR ANILLOS DE SATURNO
                    if (nombre === "saturno" && objetos.anillosSaturno) {
                        objetos.anillosSaturno.position.copy(objeto.position);
                    }
                }
            }
        });
        
        // ACTUALIZAR ETIQUETAS EN TIEMPO REAL
        actualizarEtiquetas();
    }
    
    renderizador.render(escena, camara);
}

function configurarControles() {
    let mouseDown = false;
    let lastX = 0;
    let lastY = 0;
    
    renderizador.domElement.addEventListener('mousedown', (e) => {
        mouseDown = true;
        lastX = e.clientX;
        lastY = e.clientY;
    });
    
    renderizador.domElement.addEventListener('mouseup', () => {
        mouseDown = false;
    });
    
    renderizador.domElement.addEventListener('mousemove', (e) => {
        if (!mouseDown) return;
        
        const deltaX = e.clientX - lastX;
        const deltaY = e.clientY - lastY;
        
        camara.position.x -= deltaX * 0.01;
        camara.position.y += deltaY * 0.01;
        
        lastX = e.clientX;
        lastY = e.clientY;
    });
    
    // ZOOM CON RUEDA
    renderizador.domElement.addEventListener('wheel', (e) => {
        camara.position.z += e.deltaY * 0.1;
    });
}

// CONTROLES GLOBALES
window.cambiarVista = function(vista) {
    switch(vista) {
        case 'completa': 
            camara.position.set(0, 15, 50);
            break;
        case 'interior': 
            camara.position.set(0, 8, 25);
            break;
        case 'gigantes': 
            camara.position.set(0, 12, 70);
            break;
    }
};

window.toggleAnimacion = function() {
    animacionActiva = !animacionActiva;
    document.getElementById('btnAnimacion').textContent = 
        animacionActiva ? '‚è∏Ô∏è Pausar Animaci√≥n' : '‚ñ∂Ô∏è Iniciar Animaci√≥n';
};

window.toggleCMFO = function() {
    cmfoActivo = !cmfoActivo;
    document.getElementById('btnCMFO').textContent = 
        `üîß CMFO: ${cmfoActivo ? 'ON' : 'OFF'}`;
};

// INICIALIZACI√ìN
if (typeof THREE !== 'undefined') {
    document.addEventListener('DOMContentLoaded', iniciarSistema);
    window.addEventListener('resize', () => {
        if (renderizador && camara) {
            const contenedor = document.getElementById('contenedor3d');
            camara.aspect = contenedor.clientWidth / 600;
            camara.updateProjectionMatrix();
            renderizador.setSize(contenedor.clientWidth, 600);
        }
    });
} else {
    document.getElementById('contenedor3d').innerHTML = `
        <div style="color: #ff4444; text-align: center; padding: 50px;">
            <h3>‚ùå Three.js no disponible</h3>
            <p>El simulador requiere WebGL</p>
        </div>
    `;
}
</script>
</body>
</html>

