<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Solar Realista - CMFO Astronom√≠a</title>
    <link rel="stylesheet" href="../style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        #contenedor3d {
            width: 100%;
            height: 600px;
            background: #000;
            border: 2px solid #00ffff;
            border-radius: 8px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }
        
        .etiqueta-cuerpo {
            position: absolute;
            color: #00ffff;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            font-weight: bold;
            background: rgba(0, 0, 0, 0.9);
            padding: 4px 10px;
            border-radius: 5px;
            pointer-events: none;
            z-index: 1000;
            border: 1px solid rgba(0, 255, 255, 0.5);
            white-space: nowrap;
            text-shadow: 0 0 5px #000;
        }
        
        .panel-control {
            background: rgba(0, 40, 60, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #00cccc;
        }
        
        .boton-control {
            background: linear-gradient(135deg, #0066cc, #00cccc);
            color: #000;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-weight: bold;
        }
    </style>
</head>

<body>
<nav class="navbar">
    <div class="navbar-title">CMFO Astronom√≠a</div>
    <input type="checkbox" id="menu-toggle">
    <label for="menu-toggle" class="menu-icon">&#9776;</label>
    <ul class="menu">
        <li><a href="../index.html">Inicio</a></li>
        <li><a href="../investigacion/investigacion.html">Investigaci√≥n</a></li>
        <li><a href="../datos/datos.html">Datos CMFO</a></li>
        <li><a href="visualizacion3d.html">Visualizaci√≥n 3D</a></li>
        <li><a href="../aportes/aportes.html">Aportes</a></li>
        <li><a href="../documentacion/documentacion.html">Documentaci√≥n</a></li>
        <li><a href="../contacto/contacto.html">Contacto</a></li>
    </ul>
</nav>

<header>
    <h1>Sistema Solar - Representaci√≥n Cient√≠fica Realista</h1>
    <p>Texturas procedurales generadas en tiempo real - Modelo CMFO</p>
</header>

<div class="contenedor">
    <div class="section">
        <h2>üåå Sistema Solar con Texturas Procedurales</h2>
        <div id="contenedor3d"></div>
    </div>

    <div class="panel-control">
        <h3>üéÆ Control de Visualizaci√≥n</h3>
        <button class="boton-control" onclick="cambiarVista('completa')">ü™ê Vista Completa</button>
        <button class="boton-control" onclick="cambiarVista('interior')">üåç Planetas Interiores</button>
        <button class="boton-control" onclick="cambiarVista('gigantes')">ü™ê Gigantes Gaseosos</button>
        <button class="boton-control" onclick="toggleAnimacion()" id="btnAnimacion">‚ñ∂Ô∏è Iniciar Animaci√≥n</button>
        <button class="boton-control" onclick="toggleCMFO()" id="btnCMFO">üîß CMFO: OFF</button>
    </div>
</div>

<footer>
    ¬© 2025 CMFO Astronom√≠a - Visualizaci√≥n Cient√≠fica
</footer>

<script>
// =============================================================================
// SISTEMA SOLAR PROFESIONAL - TEXTURAS PROCEDURALES
// =============================================================================

let escena, camara, renderizador;
let animacionActiva = false;
let cmfoActivo = false;
const objetos = {};
const etiquetas = {};

// CONFIGURACI√ìN CIENT√çFICA
const CUERPOS_CELESTES = {
    sol: {
        radio: 3.0,
        nombre: "SOL",
        tipo: "estrella",
        colorBase: [1.0, 0.9, 0.1],
        colorEmisivo: [1.0, 0.4, 0.1],
        distancia: 0,
        velocidadRotacion: 0.002,
        detalles: "Estrella G2V - N√∫cleo de fusi√≥n"
    },
    mercurio: {
        radio: 0.8,
        nombre: "MERCURIO", 
        tipo: "rocoso",
        colorBase: [0.6, 0.5, 0.4],
        colorSecundario: [0.4, 0.3, 0.2],
        distancia: 8,
        velocidadRotacion: 0.008,
        detalles: "Planeta rocoso - Superficie craterizada"
    },
    venus: {
        radio: 1.2,
        nombre: "VENUS",
        tipo: "atmosferico", 
        colorBase: [0.9, 0.7, 0.3],
        colorAtmosfera: [1.0, 0.8, 0.5],
        distancia: 12,
        velocidadRotacion: 0.006,
        detalles: "Atm√≥sfera densa CO‚ÇÇ - Efecto invernadero extremo"
    },
    tierra: {
        radio: 1.3,
        nombre: "TIERRA",
        tipo: "oceano",
        colorBase: [0.2, 0.4, 0.8],
        colorContinentes: [0.3, 0.6, 0.2],
        distancia: 16,
        velocidadRotacion: 0.01,
        detalles: "Planeta azul - 71% agua - √önico con vida"
    },
    marte: {
        radio: 0.9,
        nombre: "MARTE",
        tipo: "desertico",
        colorBase: [0.8, 0.3, 0.1],
        colorSecundario: [0.6, 0.2, 0.05],
        distancia: 20,
        velocidadRotacion: 0.009,
        detalles: "Planeta rojo - Monte Olimpo: 21.9 km"
    },
    jupiter: {
        radio: 2.8,
        nombre: "J√öPITER",
        tipo: "gaseoso",
        colorBase: [0.9, 0.7, 0.4],
        colorBandas: [0.7, 0.5, 0.3],
        distancia: 28,
        velocidadRotacion: 0.025,
        detalles: "Gigante gaseoso - Gran Mancha Roja"
    },
    saturno: {
        radio: 2.4,
        nombre: "SATURNO",
        tipo: "anillado",
        colorBase: [0.95, 0.85, 0.6],
        colorAnillos: [0.8, 0.7, 0.5],
        distancia: 36,
        velocidadRotacion: 0.02,
        detalles: "Sistema de anillos - 82 lunas conocidas"
    }
};

function iniciarSistema() {
    // CONFIGURACI√ìN THREE.JS
    const contenedor = document.getElementById('contenedor3d');
    
    escena = new THREE.Scene();
    escena.background = new THREE.Color(0x000011);
    escena.fog = new THREE.Fog(0x000022, 50, 200);
    
    camara = new THREE.PerspectiveCamera(60, contenedor.clientWidth / 600, 0.1, 1000);
    camara.position.set(0, 15, 50);
    
    renderizador = new THREE.WebGLRenderer({ 
        antialias: true,
        powerPreference: "high-performance"
    });
    renderizador.setSize(contenedor.clientWidth, 600);
    renderizador.shadowMap.enabled = true;
    renderizador.shadowMap.type = THREE.PCFSoftShadowMap;
    contenedor.appendChild(renderizador.domElement);
    
    // ILUMINACI√ìN PROFESIONAL
    const luzSolar = new THREE.DirectionalLight(0xffffff, 1.5);
    luzSolar.position.set(50, 50, 50);
    luzSolar.castShadow = true;
    escena.add(luzSolar);
    
    const luzAmbiental = new THREE.AmbientLight(0x404040, 0.3);
    escena.add(luzAmbiental);
    
    // CREAR SISTEMA SOLAR
    crearSistemaSolar();
    
    // FONDO ESTELAR
    crearFondoEstelar();
    
    // INICIAR ANIMACI√ìN
    animar();
    
    // CONTROLES
    configurarControles();
}

function crearTexturaProcedural(tipo, config) {
    const canvas = document.createElement('canvas');
    const size = 512;
    canvas.width = size;
    canvas.height = size;
    const ctx = canvas.getContext('2d');
    
    switch(tipo) {
        case "estrella":
            crearTexturaEstrella(ctx, size, config);
            break;
        case "rocoso":
            crearTexturaRocoso(ctx, size, config);
            break;
        case "gaseoso":
            crearTexturaGaseoso(ctx, size, config);
            break;
        case "oceano":
            crearTexturaOceano(ctx, size, config);
            break;
        case "atmosferico":
            crearTexturaAtmosferico(ctx, size, config);
            break;
    }
    
    const textura = new THREE.CanvasTexture(canvas);
    textura.wrapS = THREE.RepeatWrapping;
    textura.wrapT = THREE.RepeatWrapping;
    return textura;
}

function crearTexturaEstrella(ctx, size, config) {
    const gradient = ctx.createRadialGradient(size/2, size/2, 0, size/2, size/2, size/2);
    gradient.addColorStop(0, `rgb(255, 255, 200)`);
    gradient.addColorStop(0.3, `rgb(255, 200, 100)`);
    gradient.addColorStop(0.6, `rgb(255, 100, 50)`);
    gradient.addColorStop(1, `rgb(150, 50, 0)`);
    
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, size, size);
    
    // Efecto de granulaci√≥n solar
    for (let i = 0; i < 1000; i++) {
        const x = Math.random() * size;
        const y = Math.random() * size;
        const radio = Math.random() * 3;
        const brillo = 150 + Math.random() * 105;
        ctx.fillStyle = `rgb(${brillo}, ${brillo}, ${brillo})`;
        ctx.beginPath();
        ctx.arc(x, y, radio, 0, Math.PI * 2);
        ctx.fill();
    }
}

function crearTexturaRocoso(ctx, size, config) {
    // Base rocosa
    ctx.fillStyle = `rgb(${config.colorBase[0]*255}, ${config.colorBase[1]*255}, ${config.colorBase[2]*255})`;
    ctx.fillRect(0, 0, size, size);
    
    // Cr√°teres y accidentes
    for (let i = 0; i < 200; i++) {
        const x = Math.random() * size;
        const y = Math.random() * size;
        const radio = 2 + Math.random() * 15;
        
        // Sombra del cr√°ter
        ctx.fillStyle = `rgb(${config.colorSecundario[0]*255}, ${config.colorSecundario[1]*255}, ${config.colorSecundario[2]*255})`;
        ctx.beginPath();
        ctx.arc(x, y, radio, 0, Math.PI * 2);
        ctx.fill();
        
        // Centro iluminado
        ctx.fillStyle = `rgb(${config.colorBase[0]*255 + 30}, ${config.colorBase[1]*255 + 30}, ${config.colorBase[2]*255 + 30})`;
        ctx.beginPath();
        ctx.arc(x - radio/3, y - radio/3, radio/2, 0, Math.PI * 2);
        ctx.fill();
    }
}

function crearTexturaGaseoso(ctx, size, config) {
    // Base del planeta gaseoso
    const gradient = ctx.createLinearGradient(0, 0, size, 0);
    gradient.addColorStop(0, `rgb(${config.colorBase[0]*255}, ${config.colorBase[1]*255}, ${config.colorBase[2]*255})`);
    gradient.addColorStop(0.5, `rgb(${config.colorBandas[0]*255}, ${config.colorBandas[1]*255}, ${config.colorBandas[2]*255})`);
    gradient.addColorStop(1, `rgb(${config.colorBase[0]*255}, ${config.colorBase[1]*255}, ${config.colorBase[2]*255})`);
    
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, size, size);
    
    // Bandas atmosf√©ricas
    for (let i = 0; i < 10; i++) {
        const y = Math.random() * size;
        const altura = 10 + Math.random() * 30;
        ctx.fillStyle = `rgb(${config.colorBandas[0]*255}, ${config.colorBandas[1]*255}, ${config.colorBandas[2]*255})`;
        ctx.fillRect(0, y, size, altura);
    }
    
    // Gran Mancha Roja (para J√∫piter)
    if (config.nombre === "J√öPITER") {
        ctx.fillStyle = 'rgb(200, 100, 80)';
        ctx.beginPath();
        ctx.ellipse(size * 0.7, size * 0.4, 40, 20, 0, 0, Math.PI * 2);
        ctx.fill();
    }
}

function crearTexturaOceano(ctx, size, config) {
    // Oc√©anos
    ctx.fillStyle = `rgb(${config.colorBase[0]*255}, ${config.colorBase[1]*255}, ${config.colorBase[2]*255})`;
    ctx.fillRect(0, 0, size, size);
    
    // Continentes
    for (let i = 0; i < 8; i++) {
        const x = Math.random() * size;
        const y = Math.random() * size;
        const radio = 20 + Math.random() * 40;
        
        ctx.fillStyle = `rgb(${config.colorContinentes[0]*255}, ${config.colorContinentes[1]*255}, ${config.colorContinentes[2]*255})`;
        ctx.beginPath();
        ctx.arc(x, y, radio, 0, Math.PI * 2);
        ctx.fill();
        
        // Monta√±as
        for (let j = 0; j < 5; j++) {
            const mx = x + (Math.random() - 0.5) * radio;
            const my = y + (Math.random() - 0.5) * radio;
            ctx.fillStyle = `rgb(${config.colorContinentes[0]*255 - 20}, ${config.colorContinentes[1]*255 - 20}, ${config.colorContinentes[2]*255 - 20})`;
            ctx.beginPath();
            ctx.arc(mx, my, 5 + Math.random() * 8, 0, Math.PI * 2);
            ctx.fill();
        }
    }
}

function crearTexturaAtmosferico(ctx, size, config) {
    // Superficie
    ctx.fillStyle = `rgb(${config.colorBase[0]*255}, ${config.colorBase[1]*255}, ${config.colorBase[2]*255})`;
    ctx.fillRect(0, 0, size, size);
    
    // Nubes atmosf√©ricas
    for (let i = 0; i < 50; i++) {
        const x = Math.random() * size;
        const y = Math.random() * size;
        const radio = 10 + Math.random() * 25;
        
        ctx.fillStyle = `rgb(${config.colorAtmosfera[0]*255}, ${config.colorAtmosfera[1]*255}, ${config.colorAtmosfera[2]*255})`;
        ctx.globalAlpha = 0.3 + Math.random() * 0.4;
        ctx.beginPath();
        ctx.arc(x, y, radio, 0, Math.PI * 2);
        ctx.fill();
    }
    ctx.globalAlpha = 1.0;
}

function crearSistemaSolar() {
    Object.keys(CUERPOS_CELESTES).forEach(nombre => {
        const cuerpo = CUERPOS_CELESTES[nombre];
        
        // CREAR TEXTURA PROCEDURAL
        const textura = crearTexturaProcedural(cuerpo.tipo, cuerpo);
        
        // GEOMETR√çA DE ALTA RESOLUCI√ìN
        const geometria = new THREE.SphereGeometry(cuerpo.radio, 64, 64);
        
        // MATERIAL AVANZADO
        let material;
        if (nombre === "sol") {
            material = new THREE.MeshPhongMaterial({
                map: textura,
                emissive: new THREE.Color(...cuerpo.colorEmisivo),
                emissiveIntensity: 1.0,
                shininess: 100
            });
        } else {
            material = new THREE.MeshPhongMaterial({
                map: textura,
                shininess: 30,
                specular: 0x222222
            });
        }
        
        const mesh = new THREE.Mesh(geometria, material);
        
        // POSICI√ìN
        const angulo = Math.random() * Math.PI * 2;
        mesh.position.x = Math.cos(angulo) * cuerpo.distancia;
        mesh.position.z = Math.sin(angulo) * cuerpo.distancia;
        
        // PROPIEDADES F√çSICAS
        mesh.castShadow = true;
        mesh.receiveShadow = true;
        
        // DATOS DE ANIMACI√ìN
        mesh.userData = {
            nombre: nombre,
            velocidadRotacion: cuerpo.velocidadRotacion,
            velocidadOrbital: 0.003 + Math.random() * 0.005,
            anguloOrbital: angulo,
            distanciaOrbital: cuerpo.distancia
        };
        
        escena.add(mesh);
        objetos[nombre] = mesh;
        
        // √ìRBITA VISUAL
        crearOrbitaVisual(cuerpo.distancia);
        
        // ETIQUETA
        crearEtiqueta(nombre);
        
        // ANILLOS DE SATURNO
        if (nombre === "saturno") {
            crearAnillosSaturno(mesh.position, cuerpo.radio);
        }
    });
}

function crearAnillosSaturno(posicion, radioPlaneta) {
    const geometriaAnillos = new THREE.RingGeometry(radioPlaneta * 1.5, radioPlaneta * 2.5, 64);
    const texturaAnillos = crearTexturaAnillos();
    
    const materialAnillos = new THREE.MeshBasicMaterial({
        map: texturaAnillos,
        side: THREE.DoubleSide,
        transparent: true,
        opacity: 0.7
    });
    
    const anillos = new THREE.Mesh(geometriaAnillos, materialAnillos);
    anillos.rotation.x = Math.PI / 2;
    anillos.position.copy(posicion);
    escena.add(anillos);
    objetos.anillosSaturno = anillos;
}

function crearTexturaAnillos() {
    const canvas = document.createElement('canvas');
    const size = 512;
    canvas.width = size;
    canvas.height = size;
    const ctx = canvas.getContext('2d');
    
    const gradient = ctx.createRadialGradient(size/2, size/2, size/4, size/2, size/2, size/2);
    gradient.addColorStop(0, 'rgba(200, 180, 120, 0)');
    gradient.addColorStop(0.3, 'rgba(200, 180, 120, 0.8)');
    gradient.addColorStop(0.7, 'rgba(180, 160, 100, 0.9)');
    gradient.addColorStop(1, 'rgba(160, 140, 80, 0)');
    
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, size, size);
    
    return new THREE.CanvasTexture(canvas);
}

function crearOrbitaVisual(radio) {
    const puntos = [];
    const segmentos = 128;
    
    for (let i = 0; i <= segmentos; i++) {
        const angulo = (i / segmentos) * Math.PI * 2;
        puntos.push(new THREE.Vector3(
            Math.cos(angulo) * radio,
            0,
            Math.sin(angulo) * radio
        ));
    }
    
    const geometria = new THREE.BufferGeometry().setFromPoints(puntos);
    const material = new THREE.LineBasicMaterial({ 
        color: 0x336699,
        transparent: true,
        opacity: 0.15
    });
    
    const orbita = new THREE.Line(geometria, material);
    escena.add(orbita);
}

function crearFondoEstelar() {
    const estrellasGeometria = new THREE.BufferGeometry();
    const posiciones = [];
    const colores = [];
    
    for (let i = 0; i < 3000; i++) {
        const radio = 100 + Math.random() * 400;
        const theta = Math.random() * Math.PI * 2;
        const phi = Math.acos((Math.random() * 2) - 1);
        
        posiciones.push(
            radio * Math.sin(phi) * Math.cos(theta),
            radio * Math.sin(phi) * Math.sin(theta),
            radio * Math.cos(phi)
        );
        
        const tiposColor = [0x4488FF, 0xFFFFFF, 0xFFFF88, 0xFF8888];
        const color = tiposColor[Math.floor(Math.random() * tiposColor.length)];
        colores.push(color);
    }
    
    estrellasGeometria.setAttribute('position', new THREE.Float32BufferAttribute(posiciones, 3));
    estrellasGeometria.setAttribute('color', new THREE.Float32BufferAttribute(colores, 3));
    
    const materialEstrellas = new THREE.PointsMaterial({
        size: 1.2,
        vertexColors: true,
        sizeAttenuation: true
    });
    
    const estrellas = new THREE.Points(estrellasGeometria, materialEstrellas);
    escena.add(estrellas);
}

function crearEtiqueta(nombre) {
    const etiqueta = document.createElement('div');
    etiqueta.className = 'etiqueta-cuerpo';
    etiqueta.id = `etiqueta-${nombre}`;
    etiqueta.textContent = CUERPOS_CELESTES[nombre].nombre;
    etiqueta.style.display = 'none';
    document.getElementById('contenedor3d').appendChild(etiqueta);
    etiquetas[nombre] = etiqueta;
}

function actualizarEtiquetas() {
    Object.keys(etiquetas).forEach(nombre => {
        const cuerpo = objetos[nombre];
        const etiqueta = etiquetas[nombre];
        
        if (cuerpo && etiqueta) {
            const vector = new THREE.Vector3();
            cuerpo.getWorldPosition(vector);
            vector.project(camara);
            
            const x = (vector.x * 0.5 + 0.5) * renderizador.domElement.clientWidth;
            const y = (-(vector.y * 0.5 + 0.5)) * renderizador.domElement.clientHeight;
            
            if (vector.z > 0 && vector.z < 1) {
                etiqueta.style.left = `${x}px`;
                etiqueta.style.top = `${y}px`;
                etiqueta.style.display = 'block';
            } else {
                etiqueta.style.display = 'none';
            }
        }
    });
}

function animar() {
    requestAnimationFrame(animar);
    
    if (animacionActiva) {
        Object.keys(objetos).forEach(nombre => {
            const objeto = objetos[nombre];
            const datos = objeto.userData;
            
            if (datos) {
                // ROTACI√ìN
                objeto.rotation.y += datos.velocidadRotacion;
                
                // TRASLACI√ìN ORBITAL
                if (nombre !== "sol" && nombre !== "anillosSaturno") {
                    datos.anguloOrbital += datos.velocidadOrbital;
                    objeto.position.x = Math.cos(datos.anguloOrbital) * datos.distanciaOrbital;
                    objeto.position.z = Math.sin(datos.anguloOrbital) * datos.distanciaOrbital;
                    
                    // ACTUALIZAR ANILLOS DE SATURNO
                    if (nombre === "saturno" && objetos.anillosSaturno) {
                        objetos.anillosSaturno.position.copy(objeto.position);
                    }
                }
            }
        });
        
        actualizarEtiquetas();
    }
    
    renderizador.render(escena, camara);
}

function configurarControles() {
    let mouseDown = false;
    let lastX = 0;
    let lastY = 0;
    
    renderizador.domElement.addEventListener('mousedown', (e) => {
        mouseDown = true;
        lastX = e.clientX;
        lastY = e.clientY;
    });
    
    renderizador.domElement.addEventListener('mouseup', () => {
        mouseDown = false;
    });
    
    renderizador.domElement.addEventListener('mousemove', (e) => {
        if (!mouseDown) return;
        
        const deltaX = e.clientX - lastX;
        const deltaY = e.clientY - lastY;
        
        camara.position.x -= deltaX * 0.01;
        camara.position.y += deltaY * 0.01;
        
        lastX = e.clientX;
        lastY = e.clientY;
    });
    
    renderizador.domElement.addEventListener('wheel', (e) => {
        camara.position.z += e.deltaY * 0.1;
    });
}

// CONTROLES GLOBALES
window.cambiarVista = function(vista) {
    switch(vista) {
        case 'completa': camara.position.set(0, 15, 50); break;
        case 'interior': camara.position.set(0, 8, 25); break;
        case 'gigantes': camara.position.set(0, 12, 70); break;
    }
};

window.toggleAnimacion = function() {
    animacionActiva = !animacionActiva;
    document.getElementById('btnAnimacion').textContent = 
        animacionActiva ? '‚è∏Ô∏è Pausar Animaci√≥n' : '‚ñ∂Ô∏è Iniciar Animaci√≥n';
};

window.toggleCMFO = function() {
    cmfoActivo = !cmfoActivo;
    document.getElementById('btnCMFO').textContent = 
        `üîß CMFO: ${cmfoActivo ? 'ON' : 'OFF'}`;
};

// INICIALIZACI√ìN
if (typeof THREE !== 'undefined') {
    document.addEventListener('DOMContentLoaded', iniciarSistema);
    window.addEventListener('resize', () => {
        if (renderizador && camara) {
            const contenedor = document.getElementById('contenedor3d');
            camara.aspect = contenedor.clientWidth / 600;
            camara.updateProjectionMatrix();
            renderizador.setSize(contenedor.clientWidth, 600);
        }
    });
}
</script>
</body>
</html>
